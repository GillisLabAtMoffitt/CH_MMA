---
title: "Investigate MMA"
author: "Christelle Colin-Leitzinger"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: yes
    toc_float: yes
    toc_collapsed: no
    theme: cerulean
    highlight: pygments
editor_options:
  chunk_output_type: console
---

<style type="text/css">
h1.title {
  font-size: 25px;
}
.figure {
   margin-top: 25px;
   margin-bottom: 25px;
}

table {
    margin-top: 25px;
    margin-bottom: 25px !important;
}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      message = FALSE,
                      cache = FALSE,
                      fig.align='center'
                      )
options(gtsummary.print_engine = "gt")
options(gtsummary.as_gt.addl_cmds = "gt::tab_options(table.font.size = 12, data_row.padding = gt::px(1))")
```


<style>
div.blue { background-color:#0099CC; border-radius: 5px; padding: 20px; font-size: 38px}
</style>
<div class = "blue">

<span style="color: white;">Investigate MMA</span>

</div>
<br>

```{r library, include=FALSE}
library(tidyverse)
library(data.table)
library(VennDiagram)
library(viridis)
library(lubridate)
library(gtsummary)
library(survival)
library(survminer)
```

```{r load}
germline_patient_data <- readRDS("/Users/colinccm/Documents/GitHub/CHIP-Avatar/germline_patient_data.rds")

germline_patient_data <- germline_patient_data %>% 
  # Remove 1 duplicate patient 180
  distinct(avatar_id, .keep_all = TRUE) %>% 
  # replace value < 0.1 or < 0.10 by 0.05
  mutate_at(c("MMA_MMdx_results", "MMA_germline_results"), 
            ~ case_when(
    str_detect(., "<")                 ~ 0.05,
    TRUE                               ~ as.numeric(.)
  ))

germline_patient_data <- germline_patient_data %>% 
  mutate(MMA_germline_results_cat = case_when(
    MMA_germline_results <= 0.4          ~ "≤0.4 ~ normal",
    MMA_germline_results > 0.4           ~ ">0.4 ~ high"
  ), MMA_germline_results_cat = factor(MMA_germline_results_cat, 
                                       levels = c("≤0.4 ~ normal", ">0.4 ~ high"))
  ) %>% 
  mutate(MMA_germline_results_cat1 = case_when(
    MMA_germline_results <= median(MMA_germline_results, na.rm = TRUE)          ~ "≤ median MMA",
    MMA_germline_results > median(MMA_germline_results, na.rm = TRUE)           ~ "> median MMA"
  ), MMA_germline_results_cat1 = factor(MMA_germline_results_cat1, 
                                       levels = c("≤ median MMA", "> median MMA"))
  )
```
<br>
<br>


***

# I. MMA levels distribution

```{r summ table}
germline_patient_data %>% 
  mutate(Whole = "MM patients with WES") %>% 
  select(MMA_MMdx_results, MMA_germline_results, 
         Age_at_MMonly_diagnosis, Sex, raceeth, 
         Whole, ISS_at_MMdx,
         CH_status) %>%
  tbl_summary(by = Whole, 
              label = list(raceeth ~ "Race/ethnicity", Age_at_MMonly_diagnosis ~ "Age at MM diagnosis"),
              sort = list(everything() ~ "frequency", ISS_at_MMdx ~ "alphanumeric"),
              digits = list(Age_at_MMonly_diagnosis ~ 2)#,
              # missing = "no"
              ) %>% 
  bold_labels()
```

```{r}
germline_patient_data %>% 
  filter(!is.na(MMA_MMdx_results)) %>% 
  ggplot(aes(x= MMA_MMdx_results))+
  geom_bar(stat = "count")+
  theme_classic()
```

```{r}
germline_patient_data %>% 
  filter(!is.na(MMA_germline_results)) %>% 
  ggplot(aes(x= MMA_germline_results))+
  geom_bar(stat = "count")+
  theme_classic()
```
<br>


# II. MMA levels by CH_status
We had 5 patients with tumor samples contamination that we removed from the following analyses.
```{r by CH_status}
contamination_tumor_ids <- paste("A025767", "A025771", "A007368", "A007322", "A000111", sep = "|")

patients_clean_tumor <- germline_patient_data %>% 
  filter(!str_detect(avatar_id, contamination_tumor_ids))
```

```{r}
patients_clean_tumor %>%
  select(MMA_MMdx_results, MMA_germline_results,
         CH_status) %>% 
  tbl_summary(by = CH_status, 
              label = list(CH_status ~ "CH status"),
              sort = list(everything() ~ "frequency")) %>% 
  bold_labels() %>% add_p() %>% bold_p(t = .05) %>%
  modify_spanning_header(all_stat_cols() ~ "**CH status**")
```

```{r}
patients_clean_tumor %>% 
  filter(!is.na(MMA_MMdx_results) & !is.na(CH_status)) %>%
  ggplot(aes(x= CH_status, y=MMA_MMdx_results))+
  geom_boxplot()+
  theme_classic()+
  stat_compare_means()
```

```{r}
patients_clean_tumor %>% 
  filter(!is.na(MMA_germline_results) & !is.na(CH_status)) %>%
  ggplot(aes(x= CH_status, y=MMA_germline_results))+
  geom_boxplot()+
  theme_classic()+
  stat_compare_means()
```
<br>

# III. MMA levels by CH_status classes (DNA damages and TD)

```{r}
path <- fs::path("","Volumes","Gillis_Research","Christelle Colin-Leitzinger", "CHIP in Avatar")

ch_genes <- read_csv(paste0(path, "/MM avatar/Nancy's working files/CH calls_WES_genes_12.10.20.csv")) %>% 
  mutate(patient_id = str_remove(patient_id, "_normal")) %>% 
  distinct(patient_id, GENE, .keep_all = TRUE)

ch_wide <- ch_genes %>% 
  mutate(ARID1B = ifelse(GENE == "ARID1B", "Yes", NA_character_)) %>% 
  mutate(ASXL1 = ifelse(GENE == "ASXL1", "Yes", NA_character_)) %>% 
  mutate(ATM = ifelse(GENE == "ATM", "Yes", NA_character_)) %>% 
  mutate(CBL = ifelse(GENE == "CBL", "Yes", NA_character_)) %>% 
  mutate(CHEK2 = ifelse(GENE == "CHEK2", "Yes", NA_character_)) %>% 
  mutate(DNMT3A = ifelse(GENE == "DNMT3A", "Yes", NA_character_)) %>% 
  mutate(FLT3 = ifelse(GENE == "FLT3", "Yes", NA_character_)) %>% 
  mutate(IDH1 = ifelse(GENE == "IDH1", "Yes", NA_character_)) %>%
  mutate(JAK1 = ifelse(GENE == "JAK1", "Yes", NA_character_)) %>%
  mutate(JAK2 = ifelse(GENE == "JAK2", "Yes", NA_character_)) %>%
  mutate(KMT2D = ifelse(GENE == "KMT2D", "Yes", NA_character_)) %>%
  mutate(NOTCH1 = ifelse(GENE == "NOTCH1", "Yes", NA_character_)) %>%
  mutate(PPM1D = ifelse(GENE == "PPM1D", "Yes", NA_character_)) %>%
  mutate(RUNX1 = ifelse(GENE == "RUNX1", "Yes", NA_character_)) %>%
  mutate(SF3B1 = ifelse(GENE == "SF3B1", "Yes", NA_character_)) %>%
  mutate(STAG2 = ifelse(GENE == "STAG2", "Yes", NA_character_)) %>%
  mutate(STAT5B = ifelse(GENE == "STAT5B", "Yes", NA_character_)) %>%
  mutate(TET2 = ifelse(GENE == "TET2", "Yes", NA_character_)) %>%
  mutate(TP53 = ifelse(GENE == "TP53", "Yes", NA_character_)) %>%
  mutate(ZRSR2 = ifelse(GENE == "ZRSR2", "Yes", NA_character_)) %>%
  select(patient_id, ARID1B : ZRSR2) %>% 
  group_by(patient_id) %>% 
  fill(everything(), .direction = "updown") %>% 
  ungroup() %>% 
  distinct(patient_id, .keep_all = TRUE) %>% 
  mutate(across(where(is.character), .fns = ~ replace_na(., "No"))) %>% 
  # Create gene classes
  # DNA damage response genes (TP53, PPM1D, CHEK2)
  mutate(TD_class = case_when(
    DNMT3A == "Yes" |
      TET2 == "Yes"              ~ "Yes",
    TRUE                         ~ "No"
  )) %>% 
  mutate(DNA_damage_class = case_when(
    TP53 == "Yes" |
      PPM1D == "Yes" |
      CHEK2 == "Yes"             ~ "Yes",
    TRUE                         ~ "No"
  )) %>% 
  right_join(., patients_clean_tumor, by = c("patient_id" = "SLID_germline"))
```

## What are the CH genes mutated in blood?
```{r CH genes}
ch_wide %>% 
  select("ASXL1", "DNMT3A", "TET2", "TP53", "PPM1D",
         "SF3B1", "CBL", "JAK1", "STAT5B", 
         "ATM", "CHEK2",
         "FLT3", 
         "JAK2", "KMT2D", "NOTCH1", "RUNX1",
         "ZRSR2",
         "ARID1B", "IDH1", "STAG2",
         DNA_damage_class
         ) %>% 
  tbl_summary(type = list(all_categorical() ~ "dichotomous"),
              missing = "no") %>% 
  as_gt() %>% 
  gt::tab_source_note(gt::md("**Each gene is counted once per patient**"))
```
## MMA values by DNA damages Y/N
```{r by DNA damages}
ch_wide %>%
  select(MMA_MMdx_results, MMA_germline_results,
         DNA_damage_class) %>% 
  tbl_summary(by = DNA_damage_class, 
              # label = list(CH_status ~ "CH status"),
              sort = list(everything() ~ "frequency"),
              percent = "row") %>% 
  bold_labels() %>% add_p() %>% bold_p(t = .05) %>%
  modify_spanning_header(all_stat_cols() ~ "**DNA damage genes expressed?**")
```

## Sensitivity analysis - MMA values by CH status in DNA damage genes only
```{r}
ch_wide %>%
  filter(DNA_damage_class == "Yes" | CH_status == "No CH") %>% 
  select(MMA_MMdx_results, MMA_germline_results,
         CH_status) %>% 
  tbl_summary(by = CH_status, 
              # label = list(CH_status ~ "CH status"),
              type = list(c(MMA_MMdx_results, MMA_germline_results) ~ "continuous"),
              sort = list(everything() ~ "frequency"),
              percent = "row") %>% 
  bold_labels() %>% add_p() %>% bold_p(t = .05) %>%
  modify_spanning_header(all_stat_cols() ~ "**CH status**")
```
## MMA values by TET2/DNMT3A genes Y/N
```{r by TD}
ch_wide %>%
  select(MMA_MMdx_results, MMA_germline_results,
         TD_class) %>% 
  tbl_summary(by = TD_class, 
              # label = list(CH_status ~ "CH status"),
              sort = list(everything() ~ "frequency"),
              percent = "row") %>% 
  bold_labels() %>% add_p() %>% bold_p(t = .05) %>%
  modify_spanning_header(all_stat_cols() ~ "**TD genes expressed?**")
```

## Sensitivity analysis - MMA values by CH status in TET2/DNMT3A genes only
```{r}
ch_wide %>%
  filter(TD_class == "Yes" | CH_status == "No CH") %>% 
  select(MMA_MMdx_results, MMA_germline_results,
         CH_status) %>% 
  tbl_summary(by = CH_status, 
              # label = list(CH_status ~ "CH status"),
              type = list(c(MMA_MMdx_results, MMA_germline_results) ~ "continuous"),
              sort = list(everything() ~ "frequency"),
              percent = "row") %>% 
  bold_labels() %>% add_p() %>% bold_p(t = .05) %>%
  modify_spanning_header(all_stat_cols() ~ "**CH status**")
```
<br>

# IV. MMA level and VAF
1 patient can be represented multiple times if multiple genes mutated.

```{r MMA level and VAF}
ch_genes %>% 
  full_join(., patients_clean_tumor, by = c("patient_id" = "SLID_germline")) %>% 
  mutate(CH_status = case_when(
    CH_status == "No CH"             ~ "No CH",
    CH_status == "CH" &
      VAF_normal < 0.1            ~ "<10%",
    CH_status == "CH" &
      VAF_normal >= 0.1           ~ "≥10%"
  )) %>% 
  select(MMA_MMdx_results, MMA_germline_results,
         CH_status) %>% 
  tbl_summary(by = CH_status, 
              label = list(CH_status ~ "CH status"),
              sort = list(everything() ~ "frequency")) %>% 
  bold_labels() %>% add_p() %>% bold_p(t = .05) %>% add_q() %>%
  modify_spanning_header(all_stat_cols() ~ "**CH status**")
```

<div class = "row">
<div class = "col-md-6">
```{r}
ch_genes %>% 
  left_join(., patients_clean_tumor, by = c("patient_id" = "SLID_germline")) %>% 
  ggplot(aes(x= MMA_MMdx_results, y= VAF_normal))+
  geom_point()+
  geom_smooth(method = "lm") +
  stat_cor(size=5)+ 
  stat_regline_equation(label.x = 0.65, size=5)+
  theme_classic()
```
</div>

<div class = "col-md-6">
```{r}
ch_genes %>% 
  left_join(., patients_clean_tumor, by = c("patient_id" = "SLID_germline")) %>% 
  mutate(VAF_cat = case_when(
    VAF_normal < 0.1            ~ "<10%",
    VAF_normal >= 0.1           ~ "≥10%"
  )) %>% 
  ggplot(aes(x= VAF_cat, y= MMA_MMdx_results, color= VAF_cat))+
  geom_boxplot()+
  geom_jitter()+
  theme_classic()+
  stat_compare_means(size=5)
```
</div>
</div>

```{r}
# ch_genes %>% 
#   left_join(., patients_clean_tumor, by = c("patient_id" = "SLID_germline")) %>% 
#   mutate(VAF_cat = case_when(
#     VAF_normal < 0.1            ~ "<10%",
#     VAF_normal >= 0.1           ~ "≥10%"
#   )) %>% 
#   ggplot(aes(x= VAF_cat, y= MMA_MMdx_results, color= VAF_cat))+
#   geom_boxplot()+
#   geom_jitter()+
#   theme_classic()+
#   facet_wrap(. ~ CH_status)+
#   stat_compare_means(size=5)
```

<div class = "row">
<div class = "col-md-6">
```{r}
ch_genes %>% 
  left_join(., patients_clean_tumor, by = c("patient_id" = "SLID_germline")) %>% 
  ggplot(aes(x= MMA_germline_results, y= VAF_normal))+
  geom_point()+
  geom_smooth(method = "lm") +
  stat_cor(size=5)+ 
  stat_regline_equation(label.x = 0.65, size=5)+
  theme_classic()
```
</div>

<div class = "col-md-6">
```{r}
ch_genes %>% 
  left_join(., patients_clean_tumor, by = c("patient_id" = "SLID_germline")) %>% 
  mutate(VAF_cat = case_when(
    VAF_normal < 0.1            ~ "<10%",
    VAF_normal >= 0.1           ~ "≥10%"
  )) %>% 
  ggplot(aes(x= VAF_cat, y= MMA_germline_results, color= VAF_cat))+
  geom_boxplot()+
  geom_jitter()+
  theme_classic()+
  stat_compare_means(size=5)
```
</div>
</div>

# V. Stratified by Gender
<div class = "row">
<div class = "col-md-6">
```{r Stratified by Gender}
patients_clean_tumor %>%
  select(MMA_MMdx_results, MMA_germline_results,
         Sex) %>% 
  tbl_summary(by = Sex, 
              sort = list(everything() ~ "frequency")) %>% 
  bold_labels() %>% add_p() %>% bold_p(t = .05)
```
</div>

<div class = "col-md-6">
```{r}
patients_clean_tumor %>% 
  filter(!is.na(MMA_MMdx_results)) %>%
  ggplot(aes(x= Sex, y=MMA_MMdx_results))+
  geom_boxplot()+
  theme_classic()+
  stat_compare_means()
```
</div>
</div>

```{r}
male <- patients_clean_tumor %>%
  filter(Sex == "Male") %>% 
  select(MMA_MMdx_results, MMA_germline_results,
         CH_status) %>% 
  tbl_summary(by = CH_status, 
              label = list(CH_status ~ "CH status"),
              sort = list(everything() ~ "frequency")) %>% 
  bold_labels() %>% add_p() %>% bold_p(t = .05)

female <- patients_clean_tumor %>%
  filter(Sex == "Female") %>% 
  select(MMA_MMdx_results, MMA_germline_results,
         CH_status) %>% 
  tbl_summary(by = CH_status, 
              label = list(CH_status ~ "CH status"),
              sort = list(everything() ~ "frequency")) %>% 
  bold_labels() %>% add_p() %>% bold_p(t = .05)

tbl_merge(list(male, female), tab_spanner = c("Male", "Female"))
```

```{r}
patients_clean_tumor %>% 
  filter(!is.na(MMA_MMdx_results) & !is.na(CH_status)) %>%
  ggplot(aes(x= Sex, y=MMA_MMdx_results, color= CH_status))+
  geom_boxplot()+
  theme_classic()+
  stat_compare_means()
```

```{r}
patients_clean_tumor %>% 
  filter(!is.na(MMA_germline_results) & !is.na(CH_status)) %>%
  ggplot(aes(x= Sex, y=MMA_germline_results, color= CH_status))+
  geom_boxplot()+
  theme_classic()+
  stat_compare_means()
```
<br>
<br>

# VI. Survival

<div class = "row">
<div class = "col-md-6">
```{r Survival, fig.height = 7}
ggsurvplot(survfit(Surv(month_at_os, os_event) ~ MMA_germline_results_cat, 
                   data=patients_clean_tumor),
           title = "OS Analysis",
           font.main = c(20, "bold", "black"),
           font.x = c(18, "bold", "black"),
           font.y = c(18, "bold", "black"),
           font.legend = c(16, "black"),
           font.tickslab = c(16, "bold", "black"),
           size = 1.5,

           xlab = "Time in months",
           legend = "top",
           legend.title = "",
           pval = TRUE,
           conf.int = FALSE,
           # Censor
           censor = TRUE
) + guides(colour = guide_legend(ncol = 1))

tbl1 <- patients_clean_tumor %>% 
  select(MMA_germline_results_cat, 
         Age_at_MMonly_diagnosis, Sex, raceeth,
         ISS_at_MMdx, HCT_ever, regimen_categoryVCD_1, 
         CH_status) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor$month_at_os, 
                             event = patients_clean_tumor$os_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor$month_at_os, 
             event = patients_clean_tumor$os_event) ~ 
               MMA_germline_results_cat + Age_at_MMonly_diagnosis + Sex + raceeth + ISS_at_MMdx + HCT_ever + regimen_categoryVCD_1 + CH_status, 
             data =  patients_clean_tumor) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))

```
</div>

<div class = "col-md-6">
```{r, fig.height = 7}
ggsurvplot(survfit(Surv(month_at_progression_drug, drug_progression_event) ~ MMA_germline_results_cat, 
                   data=patients_clean_tumor),
           title = "PFS Analysis",
           font.main = c(20, "bold", "black"),
           font.x = c(18, "bold", "black"),
           font.y = c(18, "bold", "black"),
           font.legend = c(16, "black"),
           font.tickslab = c(16, "bold", "black"),
           size = 1.5,

           xlab = "Time in months",
           legend = "top",
           legend.title = "",
           pval = TRUE,
           conf.int = FALSE,
           # Censor
           censor = TRUE
) + guides(colour = guide_legend(ncol = 1))

tbl1 <- patients_clean_tumor %>% 
  select(MMA_germline_results_cat, 
         Age_at_MMonly_diagnosis, Sex, raceeth,
         ISS_at_MMdx, HCT_ever, regimen_categoryVCD_1, 
         CH_status) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor$month_at_progression_drug, 
                             event = patients_clean_tumor$drug_progression_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor$month_at_progression_drug, 
             event = patients_clean_tumor$drug_progression_event) ~ 
               MMA_germline_results_cat + Age_at_MMonly_diagnosis + Sex + raceeth + ISS_at_MMdx + HCT_ever + regimen_categoryVCD_1 + CH_status, 
             data =  patients_clean_tumor) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))
```
</div>
</div>

<div class = "row">
<div class = "col-md-6">
```{r, fig.height = 7}
ggsurvplot(survfit(Surv(month_at_os, os_event) ~ MMA_germline_results_cat + Sex, 
                   data=patients_clean_tumor),
           title = "OS Analysis",
           font.main = c(20, "bold", "black"),
           font.x = c(18, "bold", "black"),
           font.y = c(18, "bold", "black"),
           font.legend = c(16, "black"),
           font.tickslab = c(16, "bold", "black"),
           size = 1.5,

           xlab = "Time in months",
           legend = "top",
           legend.title = "",
           pval = TRUE,
           conf.int = FALSE,
           # Censor
           censor = TRUE
) + guides(colour = guide_legend(ncol = 1))
```
</div>

<div class = "col-md-6">
```{r, fig.height = 7}
ggsurvplot(survfit(Surv(month_at_progression_drug, drug_progression_event) ~ MMA_germline_results_cat + Sex, 
                   data=patients_clean_tumor),
           title = "PFS Analysis",
           font.main = c(20, "bold", "black"),
           font.x = c(18, "bold", "black"),
           font.y = c(18, "bold", "black"),
           font.legend = c(16, "black"),
           font.tickslab = c(16, "bold", "black"),
           size = 1.5,

           xlab = "Time in months",
           legend = "top",
           legend.title = "",
           pval = TRUE,
           conf.int = FALSE,
           # Censor
           censor = TRUE
) + guides(colour = guide_legend(ncol = 1))
```
</div>
</div>

## Startified in Male
```{r, fig.height = 7}
patients_clean_tumor_male <- patients_clean_tumor %>% 
  filter(Sex == "Male")
```
<div class = "row">
<div class = "col-md-6">
```{r, fig.height = 7}
ggsurvplot(survfit(Surv(month_at_os, os_event) ~ MMA_germline_results_cat + Sex, 
                   data=patients_clean_tumor_male %>% 
                     filter(Sex == "Male")),
           title = "OS Analysis",
           font.main = c(20, "bold", "black"),
           font.x = c(18, "bold", "black"),
           font.y = c(18, "bold", "black"),
           font.legend = c(16, "black"),
           font.tickslab = c(16, "bold", "black"),
           size = 1.5,

           xlab = "Time in months",
           legend = "top",
           legend.title = "",
           pval = TRUE,
           conf.int = FALSE,
           # Censor
           censor = TRUE
) + guides(colour = guide_legend(ncol = 1))

tbl1 <- patients_clean_tumor_male %>% 
  select(MMA_germline_results_cat, 
         Age_at_MMonly_diagnosis, raceeth,
         ISS_at_MMdx, HCT_ever, regimen_categoryVCD_1,
         CH_status) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor_male$month_at_os, 
                             event = patients_clean_tumor_male$os_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor_male$month_at_os, 
             event = patients_clean_tumor_male$os_event) ~ 
               MMA_germline_results_cat + Age_at_MMonly_diagnosis + raceeth + ISS_at_MMdx + HCT_ever + regimen_categoryVCD_1 + CH_status, 
             data =  patients_clean_tumor_male) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))
```
</div>

<div class = "col-md-6">
```{r, fig.height = 7}
ggsurvplot(survfit(Surv(month_at_progression_drug, drug_progression_event) ~ MMA_germline_results_cat + Sex, 
                   data=patients_clean_tumor_male %>% 
                     filter(Sex == "Male")),
           title = "PFS Analysis",
           font.main = c(20, "bold", "black"),
           font.x = c(18, "bold", "black"),
           font.y = c(18, "bold", "black"),
           font.legend = c(16, "black"),
           font.tickslab = c(16, "bold", "black"),
           size = 1.5,

           xlab = "Time in months",
           legend = "top",
           legend.title = "",
           pval = TRUE,
           conf.int = FALSE,
           # Censor
           censor = TRUE
) + guides(colour = guide_legend(ncol = 1))

tbl1 <- patients_clean_tumor_male %>% 
  select(MMA_germline_results_cat, 
         Age_at_MMonly_diagnosis, raceeth,
         ISS_at_MMdx, HCT_ever, regimen_categoryVCD_1,
         CH_status) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor_male$month_at_progression_drug, 
                             event = patients_clean_tumor_male$drug_progression_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor_male$month_at_progression_drug, 
             event = patients_clean_tumor_male$drug_progression_event) ~ 
               MMA_germline_results_cat + Age_at_MMonly_diagnosis + raceeth + ISS_at_MMdx + HCT_ever + regimen_categoryVCD_1 + CH_status, 
             data =  patients_clean_tumor_male) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))
```
</div>
</div>


<div class = "row">
<div class = "col-md-6">
```{r, fig.height = 7}
ggsurvplot(survfit(Surv(month_at_os, os_event) ~ MMA_germline_results_cat1 + Sex, 
                   data=patients_clean_tumor_male %>% 
                     filter(Sex == "Male")),
           title = "OS Analysis",
           font.main = c(20, "bold", "black"),
           font.x = c(18, "bold", "black"),
           font.y = c(18, "bold", "black"),
           font.legend = c(16, "black"),
           font.tickslab = c(16, "bold", "black"),
           size = 1.5,

           xlab = "Time in months",
           legend = "top",
           legend.title = "",
           pval = TRUE,
           conf.int = FALSE,
           # Censor
           censor = TRUE
) + guides(colour = guide_legend(ncol = 1))

tbl1 <- patients_clean_tumor_male %>% 
  select(MMA_germline_results_cat1, 
         Age_at_MMonly_diagnosis, raceeth,
         ISS_at_MMdx, HCT_ever, regimen_categoryVCD_1,
         CH_status) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor_male$month_at_os, 
                             event = patients_clean_tumor_male$os_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor_male$month_at_os, 
             event = patients_clean_tumor_male$os_event) ~ 
               MMA_germline_results_cat1 + Age_at_MMonly_diagnosis + raceeth + ISS_at_MMdx + HCT_ever + regimen_categoryVCD_1 + CH_status, 
             data =  patients_clean_tumor_male) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))
```
</div>

<div class = "col-md-6">
```{r, fig.height = 7}
ggsurvplot(survfit(Surv(month_at_progression_drug, drug_progression_event) ~ MMA_germline_results_cat1 + Sex, 
                   data=patients_clean_tumor_male %>% 
                     filter(Sex == "Male")),
           title = "PFS Analysis",
           font.main = c(20, "bold", "black"),
           font.x = c(18, "bold", "black"),
           font.y = c(18, "bold", "black"),
           font.legend = c(16, "black"),
           font.tickslab = c(16, "bold", "black"),
           size = 1.5,

           xlab = "Time in months",
           legend = "top",
           legend.title = "",
           pval = TRUE,
           conf.int = FALSE,
           # Censor
           censor = TRUE
) + guides(colour = guide_legend(ncol = 1))

tbl1 <- patients_clean_tumor_male %>% 
  select(MMA_germline_results_cat1, 
         Age_at_MMonly_diagnosis, raceeth,
         ISS_at_MMdx, HCT_ever, regimen_categoryVCD_1,
         CH_status) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor_male$month_at_progression_drug, 
                             event = patients_clean_tumor_male$drug_progression_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor_male$month_at_progression_drug, 
             event = patients_clean_tumor_male$drug_progression_event) ~ 
               MMA_germline_results_cat1 + Age_at_MMonly_diagnosis + raceeth + ISS_at_MMdx + HCT_ever + regimen_categoryVCD_1 + CH_status, 
             data =  patients_clean_tumor_male) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))
```
</div>
</div>

# Notes

- ~~Succinate~~
- kidney dysfunction increases MMA




