---
title: "ICUS vs CCUS analysis and MMA"
author: "Christelle Colin-Leitzinger"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: yes
    toc_float: yes
    toc_collapsed: no
    theme: cerulean
    highlight: pygments
    df_print: paged
editor_options:
  chunk_output_type: console
---

<style type="text/css">
h1.title {
  font-size: 25px;
}
.figure {
   margin-top: 25px;
   margin-bottom: 25px;
}

table {
    margin-top: 25px;
    margin-bottom: 25px !important;
}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      message = FALSE,
                      cache = FALSE,
                      fig.align='center'
                      )
```


<style>
div.blue { background-color:#0099CC; border-radius: 5px; padding: 20px; font-size: 38px}
</style>
<div class = "blue">

<span style="color: white;">ICUS vs CCUS analysis</span>

</div>
<br>

```{r library, include=FALSE}
library(tidyverse)
library(viridis)
library(lubridate)
library(labelled)
library(gtsummary)
library(survival)
library(survminer)
theme_gtsummary_compact()
theme_set(theme_classic(base_size = 18))
```

```{r load}
path <- fs::path("","Volumes","Gillis_Research","Christelle Colin-Leitzinger", "CH and MMA")

variant <- 
  read_csv(paste0(here::here(), "/ICUS vs CCUS analysis/Variant_data_for_Padron_2023-08-28.csv"))

clinical <- 
  read_csv(paste0(here::here(), "/ICUS vs CCUS analysis/Clinical_data_for_Padron_2023-08-28.csv")) %>% 
  distinct()

MMA <- 
  readxl::read_xlsx(here::here(
    "ICUS vs CCUS analysis/Padron MMA and Succinate in human serum 12132023.xlsx"))
```

```{r}
med_data <- left_join(MMA %>% 
                    rename(SAMPLE_ID = s_sampleid), 
                  clinical, 
                  by = c("MDSEPID", "SAMPLE_ID")) %>% 
  left_join(., variant, 
                  by = c("MDSEPID", "SAMPLE_ID")) %>% 
  janitor::clean_names() %>% 
  # update CCUS/ICUS group
  mutate(group = case_when(
    variant_confidence_level == 
      "Level 1 (Manually Curated)"            ~ "CCUS_GROUP",
    is.na(variant_confidence_level)           ~ "ICUS_GROUP"
  )) %>% 
  mutate(med_name = str_to_lower(med_name)) %>% 
  mutate(b12_supplement = case_when(
    # is.na(med_reason)                ~ "No",
    !is.na(med_reason)               ~ "Yes",
  )) %>% 
  group_by(mdsepid) %>% 
  fill(b12_supplement, .direction = "updown") %>% 
  ungroup() %>% 
  mutate(b12_supplement = case_when(
    b12_supplement == "Yes"          ~ "Yes",
    is.na(med_reason)                ~ "No"
  ))
  

data <- left_join(MMA %>% 
                    rename(SAMPLE_ID = s_sampleid), 
                  clinical, 
                  by = c("MDSEPID", "SAMPLE_ID")) %>% 
  # Remove duplicate rows due to drugs
  distinct(MDSEPID, SAMPLE_ID, .keep_all = TRUE) %>% 
  left_join(., variant, 
                  by = c("MDSEPID", "SAMPLE_ID")) %>% 
  janitor::clean_names() %>% 
  rename(patient_id = mdsepid) %>% 
  # update CCUS/ICUS group
  mutate(group = case_when(
    variant_confidence_level == 
      "Level 1 (Manually Curated)"            ~ "CCUS_GROUP",
    is.na(variant_confidence_level)           ~ "ICUS_GROUP"
  )) %>% 
  # MMA----
  mutate(mma_um = mma_n_m / 1000) %>% 
  mutate(mma_cat = case_when(
    mma_um <= 0.4          ~ "≤0.4 ~ normal",
    mma_um > 0.4           ~ ">0.4 ~ high"
  ), mma_cat = factor(mma_cat, 
                      levels = c("≤0.4 ~ normal", ">0.4 ~ high"))
  ) %>% 
  # B12----
  mutate(b12_interpretation = case_when(
    baseline_b12_serum < 200             ~ "Low/Normal",
    baseline_b12_serum >= 200 &
      baseline_b12_serum <= 900          ~ "Low/Normal",
    baseline_b12_serum > 900             ~ "High"
  ), b12_interpretation = factor(b12_interpretation, 
                                 levels = c("Low/Normal", "High"))) %>% 
  # BMI----
  mutate(height_m = height_cm / 100,
         bmi = weight_kg / (height_m * height_m)) %>%
  mutate(bmi_cat = case_when(
    bmi < 18.5                  ~ "< 18.5",
    bmi >= 18.5 &
      bmi < 25                  ~ "18.5 - 25",
    bmi >= 25 &
      bmi < 30                  ~ "25 - 30",
    bmi >= 30                   ~ "≥ 30"
  )) %>%
  mutate(bmi_cat = factor(bmi_cat, levels = c("< 18.5", "18.5 - 25", "25 - 30", "≥ 30"))) %>% 
  # Now can Calculate ideal dody weight
  mutate(ideal_weight = case_when(
    sex == "Female" &
      height_m <= 1.524               ~ 45.5 + 2.3,
    sex == "Female" &
      height_m > 1.524                ~ 45.5 + (2.3 * (((height_m - 1.524) / 0.0254))),
    sex == "Male" &
      height_m <= 1.524               ~ 50 + 2.3,
    sex == "Male" &
      height_m > 1.524                ~ 50 + (2.3 * (((height_m - 1.524) / 0.0254)))
  )) %>% 
  mutate(adjusted_weight = ((weight_kg - ideal_weight) * 0.40) + ideal_weight
  ) %>%
  # CrCl----
  mutate(baseline_creatinine_serum = as.numeric(baseline_creatinine_serum),
         baseline_creatinine_serum = case_when(
           baseline_creatinine_serum < 0.7      ~ 0.7,
           TRUE                                   ~ baseline_creatinine_serum
         )) %>%
  # Calculate CrCl
  mutate(CrCl = case_when(
    sex == "Female"                   ~ ((
      ((140 - age) * weight_kg) /
        (72 * baseline_creatinine_serum)) * 
        0.85),
    
    sex == "Male"                     ~ (
      ((140 - age) * weight_kg) / 
        (72 * baseline_creatinine_serum)
      )
  ),
  CrCl = round(CrCl, 0)) %>% 
  
  mutate(adjusted_CrCl = case_when(
    sex == "Female"                   ~ ((
      ((140 - age) * adjusted_weight) /
        (72 * baseline_creatinine_serum)) * 
        0.85),
    
    sex == "Male"                     ~ (
      ((140 - age) * adjusted_weight) / 
        (72 * baseline_creatinine_serum)
      )
  ),
  adjusted_CrCl = round(adjusted_CrCl, 0)) %>% 

  mutate(calculated_CrCl = case_when(
    bmi >= 25                 ~ adjusted_CrCl,
    bmi < 25                  ~ CrCl
  )) %>% 
  mutate(CrCl_units = "mL/min/1.73m2") %>% 
  mutate(CrCl_interpretation = case_when(
    calculated_CrCl < 60                    ~ "Low",
    calculated_CrCl >= 60                   ~ "Normal"
  ), CrCl_interpretation = factor(CrCl_interpretation, 
                                  levels = c("Normal", "Low"))) %>% 
  
  # Age----
  mutate(age_cat = case_when(
    age < 50               ~ "< 50",
    age >= 50 & 
      age < 60             ~ "≥ 50 - 60",
    age >= 60 & 
      age < 70             ~ "≥ 60 - 70",
    age >= 70 & 
      age < 80             ~ "≥ 70 - 80",
    age >= 80 & 
      age < 90             ~ "≥ 80 - 90",
    age >= 90              ~ "≥ 90"
  )) %>% 
  mutate(age_cat2 = case_when(
    age < 50               ~ "< 50",
    age >= 50 & 
      age < 65             ~ "≥ 50 - 65",
    age >= 65              ~ "≥ 90"
  )) %>% 

  # OS----
  mutate(os_event = case_when(
    !is.na(death_dt)       ~ 1,
    is.na(death_dt)        ~ 0
  )) %>% 
  mutate_at(c("death_dt", "last_contact_dt", "start_dt"), ~ as.Date(., "%m/%d/%y")) %>% 
  mutate(os_date = coalesce(death_dt, last_contact_dt)) %>% 
  mutate(os_time = interval(start = start_dt, end = os_date) /
           duration(n = 1, units = "months"))
```

```{r Labeling}
var_label(data) <- list(age = "Patient age", 
                        sex = "Sex", 
                        bmi = "BMI", bmi_cat = "BMI categories", 
                        renal_disease = "Renal disease", 
                        mma_um = "MMA (µM)", mma_cat = "MMA (categories)",
                        succinate_ug_m_l = "Succinate (µg/ml)",
                        baseline_b12_serum = "Baseline B12 (pg/mL)",
                        b12_interpretation = "B12 (categories)", 
                        baseline_creatinine_serum = "Baseline creatinine (mg/dL)",
                        calculated_CrCl = "Creatinine clearance (mL/min/1.73m2)",
                        CrCl_interpretation = "Creatinine clearance (categories)",
                        age_of_the_samples_days = "Sample Storage Time (days)",
                        variant_confidence_level = "Variant Confidence Level")
```

# I. Table 1 - Clinical
```{r}
data %>% 
  distinct(patient_id, .keep_all = TRUE) %>% 
  select(age, sex,
         bmi, bmi_cat,
         mma_um, mma_cat,
         baseline_b12_serum, 
         b12_interpretation, 
         baseline_creatinine_serum,
         renal_disease,
         calculated_CrCl,
         CrCl_interpretation,
         group) %>% 
  tbl_summary(by = group) %>% 
  bold_labels() %>% add_overall() %>% 
  add_p() %>% bold_p(t = 0.05)

# tbl1 <- 
  med_data %>% 
  distinct(mdsepid, .keep_all = TRUE) %>% 
  select(b12_supplement,
         group) %>% 
  tbl_summary(by = group, 
              type = everything() ~ "categorical",
              sort = everything() ~ "frequency") %>% 
  bold_labels() %>% add_overall() %>% 
  add_p() %>% bold_p(t = 0.05)

# tbl2 <- med_data %>% 
#   select(med_name, med_reason,
#          group) %>% 
#   mutate(across(starts_with("med_"), ~ str_to_sentence(.))) %>% 
#   tbl_summary(by = group, 
#               sort = everything() ~ "frequency") %>% 
#   bold_labels() %>% add_overall() %>% 
#   add_p() %>% bold_p(t = 0.05)
# 
# tbl_stack(list(tbl1, tbl2))
```

# II. Table 2 - Variant
## ALL variants of all patients
I reclassify the ICUS patient with a known mutation as CCUS.
```{r}
# data %>% 
#   distinct(patient_id, .keep_all = TRUE) %>% 
#   select(variant_confidence_level,
#          group) %>% 
#   tbl_summary(by = group) %>% 
#   bold_labels() %>% add_overall() %>% 
#   add_p() %>% bold_p(t = 0.05)
# 
# data %>% 
#   filter(variant_confidence_level == "Level 1 (Manually Curated)" &
#            group == "ICUS_GROUP") %>% 
#   select(patient_id, group,
#          gene : variant_confidence_level, 
#          everything())
```

## Mutations count summarized by gene
```{r}
# data %>% 
#   filter(!is.na(gene)) %>% 
#   # Count has patient - remove duplicate gene per patient
#   distinct(patient_id, gene) %>% 
#   select(gene) %>% 
#   tbl_summary(sort = everything() ~ "frequency") %>% 
#   bold_labels()

library(fastDummies)
dum <- data %>% 
  select(patient_id, gene) %>% 
  filter(!is.na(gene)) %>% 
  distinct(patient_id, gene)
dum %>% 
  dummy_cols(select_columns = "gene") %>% 
  select(-gene) %>% 
  mutate(across(starts_with("gene"), ~ na_if(., 0))) %>% 
  group_by(patient_id) %>% 
  fill(everything(), .direction = "updown") %>% 
  ungroup() %>% 
  distinct(patient_id, .keep_all = TRUE) %>% 
  mutate(across(starts_with("gene"), .fns = ~ replace_na(., 0))) %>% 
  select(-patient_id) %>% 
  `colnames<-`(str_remove(colnames(.), "gene_")) %>% 
  tbl_summary(sort = everything() ~ "frequency") %>% 
  bold_labels()
```


# III. Explore group, age and sex
## 1. CCUS vs. ICUS
<div class = "row">
<div class = "col-md-6">
```{r}
data %>% 
  distinct(patient_id, .keep_all = TRUE) %>% 
  ggplot(aes(x = group, y = mma_um))+
  geom_violin()+
  geom_jitter(color="grey")+
  geom_boxplot(width=0.1, outlier.shape = NA)+
  labs(x = NULL, y = "MMA (µM)")

```
</div>

<div class = "col-md-6">
```{r}
data %>% 
  distinct(patient_id, .keep_all = TRUE) %>% 
  select(group, mma_um, mma_cat) %>% 
  tbl_summary(by = group) %>% 
  bold_labels() %>% 
  add_p() %>% bold_p(t = 0.05)

```
</div>
</div>


## 2. Age
<div class = "row">
<div class = "col-md-6">

```{r}
data %>% 
  distinct(patient_id, .keep_all = TRUE) %>% 
  ggplot(aes(x = age, y = mma_um))+
  geom_point(aes(color = age_cat))+
  geom_smooth(method = "lm", se=FALSE, color="black", formula = y ~ x) +
  stat_cor(label.y = 1)+ 
  stat_regline_equation(label.y = 0.75)+
  labs(x = "Age (continuous)", y = "MMA (µM)")

```
</div>

<div class = "col-md-6">
```{r}
data %>% 
  distinct(patient_id, .keep_all = TRUE) %>% 
  select(age_cat, mma_um, mma_cat) %>% 
  tbl_summary(by = age_cat) %>% 
  bold_labels() %>% 
  add_p() %>% bold_p(t = 0.05)

```
</div>
</div>



## 4. Sex
<div class = "row">
<div class = "col-md-6">
MMA
```{r}
data %>% 
  distinct(patient_id, .keep_all = TRUE) %>% 
  ggplot(aes(x = sex, y = mma_um))+
  geom_violin()+
  geom_jitter(color="grey")+
  geom_boxplot(width=0.1, outlier.shape = NA)+
  labs(x = NULL, y = "MMA (µM)")

```
</div>

<div class = "col-md-6">
```{r}
data %>% 
  distinct(patient_id, .keep_all = TRUE) %>% 
  select(sex, mma_um, mma_cat) %>% 
  tbl_summary(by = sex) %>% 
  bold_labels() %>% 
  add_p() %>% bold_p(t = 0.05)

```
</div>
</div>

# IV.	Is MMA associated with age in CCUS vs ICUS?
```{r}
data %>% 
  filter(age < 65) %>% 
  distinct(patient_id, .keep_all = TRUE) %>% 
  select(
         mma_um, mma_cat,
         baseline_b12_serum, 
         b12_interpretation, 
         group) %>% 
  tbl_summary(by = group) %>% 
  bold_labels() %>% add_overall() %>% 
  add_p() %>% bold_p(t = 0.05) %>% 
  modify_caption("Patients with age < 65")
```

# V. Mutations categories
```{r}
mut_group <- data %>% 
  select(patient_id, gene, everything()) %>%
  # filter(!is.na(gene)) %>%
  distinct(patient_id, gene, .keep_all = TRUE)


mut_group <- mut_group %>% 
  dummy_cols(select_columns = "gene") %>% 
  select(-gene) %>% 
  mutate(across(starts_with("gene"), ~ na_if(., 0))) %>% 
  group_by(patient_id) %>% 
  fill(everything(), .direction = "updown") %>% 
  ungroup() %>% 
  distinct(patient_id, .keep_all = TRUE) %>% 
  mutate(across(starts_with("gene"), .fns = ~ replace_na(., 0))) %>% 
  rename(ICUS = gene_NA)

mut_group1 <- mut_group %>% 
  mutate(TET2_vs_CCUS_ICUS = case_when(
    ICUS == 1                              ~ "ICUS",
    gene_TET2 == 1                         ~ "TET2",
    if_any(starts_with("gene")) == 1       ~ "CCUS",
  ), TET2_vs_CCUS_ICUS = factor(TET2_vs_CCUS_ICUS, 
                                levels = c("TET2", "CCUS", "ICUS"))) %>% 
  mutate(DTA_vs_CCUS_ICUS = case_when(
    ICUS == 1                              ~ "ICUS",
    gene_TET2 == 1 |
    gene_ASXL1 == 1 |
    gene_DNMT3A == 1                       ~ "DTA",
    if_any(starts_with("gene")) == 1       ~ "CCUS",
  ), DTA_vs_CCUS_ICUS = factor(DTA_vs_CCUS_ICUS, 
                                levels = c("DTA", "CCUS", "ICUS"))) %>% 
  mutate(DT_vs_CCUS_ICUS = case_when(
    ICUS == 1                              ~ "ICUS",
    gene_TET2 == 1 |
    gene_DNMT3A == 1                       ~ "DT",
    if_any(starts_with("gene")) == 1       ~ "CCUS",
  ), DT_vs_CCUS_ICUS = factor(DT_vs_CCUS_ICUS, 
                                levels = c("DT", "CCUS", "ICUS"))) %>% 
  mutate(DNAdamage_vs_CCUS_ICUS = case_when(
    ICUS == 1                              ~ "ICUS",
    gene_TP53 == 1 |
    # gene_CHECK2 == 1 |
    gene_PPM1D == 1                        ~ "DNA_damage",
    if_any(starts_with("gene")) == 1       ~ "CCUS",
  ), DNAdamage_vs_CCUS_ICUS = factor(DNAdamage_vs_CCUS_ICUS, 
                                levels = c("DNA_damage", "CCUS", "ICUS"))) %>% 
  # mutate(rs = rowSums(select(.,starts_with("gene")), na.rm = TRUE)) %>% 
  select(patient_id, # rs, 
         TET2_vs_CCUS_ICUS, starts_with("gene"), 
         ICUS, everything())
```

## TET2_vs_CCUS_vs_ICUS
```{r}
mut_group1 %>% 
  select(
         mma_um, mma_cat,
         baseline_b12_serum, 
         b12_interpretation, 
         TET2_vs_CCUS_ICUS) %>% 
  tbl_summary(by = TET2_vs_CCUS_ICUS) %>% 
  bold_labels() %>% add_overall() %>% 
  add_p() %>% bold_p(t = 0.05)
```

## TET2_vs_CCUS+ICUS
```{r}
mut_group1 %>% 
  mutate(TET2_vs_CCUS_ICUS = case_when(
    TET2_vs_CCUS_ICUS == "ICUS" |
      TET2_vs_CCUS_ICUS == "CCUS"          ~ "ICUS + No TET2 CCUS",
    TET2_vs_CCUS_ICUS == "TET2"            ~ "TET2"
  ), TET2_vs_CCUS_ICUS = factor(TET2_vs_CCUS_ICUS, 
                                levels = c("TET2", "ICUS + No TET2 CCUS"))) %>% 
  select(
         mma_um, mma_cat,
         baseline_b12_serum, 
         b12_interpretation, 
         TET2_vs_CCUS_ICUS) %>% 
  tbl_summary(by = TET2_vs_CCUS_ICUS) %>% 
  bold_labels() %>% add_overall() %>% 
  add_p() %>% bold_p(t = 0.05)
```

## DTA_vs_CCUS_vs_ICUS
```{r}
mut_group1 %>% 
  select(
         mma_um, mma_cat,
         baseline_b12_serum, 
         b12_interpretation, 
         DTA_vs_CCUS_ICUS) %>% 
  tbl_summary(by = DTA_vs_CCUS_ICUS) %>% 
  bold_labels() %>% add_overall() %>% 
  add_p() %>% bold_p(t = 0.05)
```

## DTA_vs_CCUS+ICUS
```{r}
mut_group1 %>% 
  mutate(DTA_vs_CCUS_ICUS = case_when(
    DTA_vs_CCUS_ICUS == "ICUS" |
      DTA_vs_CCUS_ICUS == "CCUS"          ~ "ICUS + No DTA CCUS",
    DTA_vs_CCUS_ICUS == "DTA"            ~ "DTA"
  ), DTA_vs_CCUS_ICUS = factor(DTA_vs_CCUS_ICUS, 
                                levels = c("DTA", "ICUS + No DTA CCUS"))) %>% 
  select(
         mma_um, mma_cat,
         baseline_b12_serum, 
         b12_interpretation, 
         DTA_vs_CCUS_ICUS) %>% 
  tbl_summary(by = DTA_vs_CCUS_ICUS) %>% 
  bold_labels() %>% add_overall() %>% 
  add_p() %>% bold_p(t = 0.05)
```

## DT_vs_CCUS_vs_ICUS
```{r}
mut_group1 %>% 
  select(
         mma_um, mma_cat,
         baseline_b12_serum, 
         b12_interpretation, 
         DT_vs_CCUS_ICUS) %>% 
  tbl_summary(by = DT_vs_CCUS_ICUS) %>% 
  bold_labels() %>% add_overall() %>% 
  add_p() %>% bold_p(t = 0.05)
```

## DT_vs_CCUS+ICUS
```{r}
mut_group1 %>% 
  mutate(DT_vs_CCUS_ICUS = case_when(
    DT_vs_CCUS_ICUS == "ICUS" |
      DT_vs_CCUS_ICUS == "CCUS"          ~ "ICUS + No DT CCUS",
    DT_vs_CCUS_ICUS == "DT"            ~ "DT"
  ), DT_vs_CCUS_ICUS = factor(DT_vs_CCUS_ICUS, 
                                levels = c("DT", "ICUS + No DT CCUS"))) %>% 
  select(
         mma_um, mma_cat,
         baseline_b12_serum, 
         b12_interpretation, 
         DT_vs_CCUS_ICUS) %>% 
  tbl_summary(by = DT_vs_CCUS_ICUS) %>% 
  bold_labels() %>% add_overall() %>% 
  add_p() %>% bold_p(t = 0.05)
```

## DNA_damage_vs_CCUS_vs_ICUS
```{r}
mut_group1 %>% 
  select(
         mma_um, mma_cat,
         baseline_b12_serum, 
         b12_interpretation, 
         DNAdamage_vs_CCUS_ICUS) %>% 
  tbl_summary(by = DNAdamage_vs_CCUS_ICUS) %>% 
  bold_labels() %>% add_overall() %>% 
  add_p() %>% bold_p(t = 0.05)
```

## DNA_damage_vs_CCUS+ICUS
```{r}
mut_group1 %>% 
  mutate(DNAdamage_vs_CCUS_ICUS = case_when(
    DNAdamage_vs_CCUS_ICUS == "ICUS" |
      DNAdamage_vs_CCUS_ICUS == "CCUS"          ~ "ICUS + No DNA_damage CCUS",
    DNAdamage_vs_CCUS_ICUS == "DNA_damage"            ~ "DNA_damage"
  ), DNAdamage_vs_CCUS_ICUS = factor(DNAdamage_vs_CCUS_ICUS, 
                                levels = c("DNA_damage", "ICUS + No DNA_damage CCUS"))) %>% 
  select(
         mma_um, mma_cat,
         baseline_b12_serum, 
         b12_interpretation, 
         DNAdamage_vs_CCUS_ICUS) %>% 
  tbl_summary(by = DNAdamage_vs_CCUS_ICUS) %>% 
  bold_labels() %>% add_overall() %>% 
  add_p() %>% bold_p(t = 0.05)
```





<!-- # IV. Stratified analyses -->


<!-- ## 2. Stratified by age -->
<!-- <div class = "row"> -->
<!-- <div class = "col-md-6"> -->
<!-- MMA -->
<!-- ```{r, fig.height=8} -->
<!-- data %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   ggplot(aes(x = age, y = mma_um))+ -->
<!--   geom_point(aes(color = age_cat2))+ -->
<!--   geom_smooth(method = "lm", se=FALSE, color="black", formula = y ~ x) + -->
<!--   stat_cor(label.y = 1)+  -->
<!--   stat_regline_equation(label.y = 0.75)+ -->
<!--   labs(x = "Age", y = "MMA (µM)")+ -->
<!--   facet_wrap(. ~ age_cat2, ncol = 1) -->

<!-- data %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   select(age_cat2, mma_um, mma_cat) %>%  -->
<!--   tbl_summary(by = age_cat2) %>%  -->
<!--   bold_labels() %>%  -->
<!--   add_p() %>% bold_p(t = 0.05) -->
<!-- ``` -->
<!-- </div> -->

<!-- <div class = "col-md-6"> -->

<!-- </div> -->
<!-- </div> -->


<!-- <div class = "row"> -->
<!-- <div class = "col-md-6"> -->
<!-- MMA -->
<!-- ```{r} -->
<!-- data %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   filter(age > 50) %>%  -->
<!--   ggplot(aes(x = age, y = mma_um))+ -->
<!--   geom_point(color = "purple")+ -->
<!--   geom_smooth(method = "lm", se=FALSE, color="black", formula = y ~ x) + -->
<!--   stat_cor(label.y = 1)+  -->
<!--   stat_regline_equation(label.y = 0.75)+ -->
<!--   labs(x = "Age", y = "MMA (µM)",  -->
<!--        subtitle = "Age > 50") -->

<!-- data %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   filter(age > 60) %>%  -->
<!--   ggplot(aes(x = age, y = mma_um))+ -->
<!--   geom_point(color = "purple")+ -->
<!--   geom_smooth(method = "lm", se=FALSE, color="black", formula = y ~ x) + -->
<!--   stat_cor(label.y = 1)+  -->
<!--   stat_regline_equation(label.y = 0.75)+ -->
<!--   labs(x = "Age", y = "MMA (µM)",  -->
<!--        subtitle = "Age > 60") -->

<!-- data %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   filter(age > 65) %>%  -->
<!--   ggplot(aes(x = age, y = mma_um))+ -->
<!--   geom_point(color = "purple")+ -->
<!--   geom_smooth(method = "lm", se=FALSE, color="black", formula = y ~ x) + -->
<!--   stat_cor(label.y = 1)+  -->
<!--   stat_regline_equation(label.y = 0.75)+ -->
<!--   labs(x = "Age", y = "MMA (µM)",  -->
<!--        subtitle = "Age > 65") -->
<!-- ``` -->
<!-- </div> -->

<!-- <div class = "col-md-6"> -->

<!-- </div> -->
<!-- </div> -->

<!-- ## 3. Stratified by Sex -->
<!-- ### Male -->
<!-- ```{r Male} -->
<!-- data %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   filter(sex == "Male") %>%  -->
<!--   select(mma_um, mma_cat, -->
<!--          group) %>%  -->
<!--   tbl_summary(by = group) %>%  -->
<!--   bold_labels() %>% add_overall() %>%  -->
<!--   add_p() %>% bold_p(t = 0.05) -->
<!-- ``` -->




<!-- ### Female -->
<!-- ```{r Female} -->
<!-- data %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   filter(sex == "Female") %>%  -->
<!--   select(mma_um, mma_cat, -->
<!--          group) %>%  -->
<!--   tbl_summary(by = group) %>%  -->
<!--   bold_labels() %>% add_overall() %>%  -->
<!--   add_p() %>% bold_p(t = 0.05) -->
<!-- ``` -->



<!-- ## 4. Stratified by group -->
<!-- ### ICUS -->
<!-- ```{r ICUS} -->
<!-- data %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   filter(group == "ICUS_GROUP") %>%  -->
<!--   select(mma_um, mma_cat, -->
<!--          sex) %>%  -->
<!--   tbl_summary(by = sex) %>%  -->
<!--   bold_labels() %>% add_overall() %>%  -->
<!--   add_p() %>% bold_p(t = 0.05) -->
<!-- ``` -->




<!-- ### CCUS -->
<!-- ```{r} -->
<!-- data %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   filter(group == "CCUS_GROUP") %>%  -->
<!--   select(mma_um, mma_cat, -->
<!--          sex) %>%  -->
<!--   tbl_summary(by = sex) %>%  -->
<!--   bold_labels() %>% add_overall() %>%  -->
<!--   add_p() %>% bold_p(t = 0.05) -->
<!-- ``` -->



<!-- ## 5. MMA & B12 -->
<!-- ```{r MMA & B12} -->
<!-- data %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   ggplot(aes(x = baseline_b12_serum, y = mma_um))+ -->
<!--   geom_point(color = "blue")+ -->
<!--   geom_smooth(method = "lm", se=FALSE, color="black", formula = y ~ x) + -->
<!--   stat_cor(label.y = 1)+  -->
<!--   stat_regline_equation(label.y = 0.75)+ -->
<!--   labs(x = "Baseline B12 (pg/mL)", y = "MMA (µM)") -->

<!-- data %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   filter(!is.na(b12_interpretation)) %>%  -->
<!--   ggplot(aes(x = b12_interpretation, y = mma_um))+ -->
<!--   geom_boxplot()+ -->
<!--   geom_jitter(color="grey") -->

<!-- data %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   select(b12_interpretation, mma_um) %>%  -->
<!--   tbl_summary(by = b12_interpretation) %>%  -->
<!--   bold_labels() %>%  -->
<!--   add_p() %>% bold_p(t = 0.05) -->
<!-- ``` -->

<!-- ## 6. MMA & kidney function (renal disease) -->
<!-- <div class = "row"> -->
<!-- <div class = "col-md-6"> -->
<!-- ```{r MMA & kidney function} -->
<!-- data %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   filter(!is.na(renal_disease)) %>%  -->
<!--   ggplot(aes(x = renal_disease, y = mma_um))+ -->
<!--   geom_violin()+ -->
<!--   geom_jitter(color="grey")+ -->
<!--   geom_boxplot(width=0.1, outlier.shape = NA)+ -->
<!--   labs(x = "Renal disease", y = "MMA (µM)") -->

<!-- data %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   select(renal_disease, mma_um) %>%  -->
<!--   tbl_summary(by = renal_disease) %>%  -->
<!--   bold_labels() %>%  -->
<!--   add_p() %>% bold_p(t = 0.05) -->
<!-- ``` -->
<!-- </div> -->

<!-- <div class = "col-md-6"> -->
<!-- ```{r} -->
<!-- data %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   filter(!is.na(CrCl_interpretation)) %>%  -->
<!--   ggplot(aes(x = CrCl_interpretation, y = mma_um))+ -->
<!--   geom_violin()+ -->
<!--   geom_jitter(color="grey")+ -->
<!--   geom_boxplot(width=0.1, outlier.shape = NA)+ -->
<!--   labs(x = "Creatinine clearance", y = "MMA (µM)") -->

<!-- data %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   select(CrCl_interpretation, mma_um) %>%  -->
<!--   tbl_summary(by = CrCl_interpretation) %>%  -->
<!--   bold_labels() %>%  -->
<!--   add_p() %>% bold_p(t = 0.05) -->
<!-- ``` -->
<!-- </div> -->
<!-- </div> -->


# VI. CCUS vs ICUS MMA when exclude patients on B12 supplementation
```{r exclude patients on B12 supplementation}
# b12_excluded <- med_data %>%
#   rename(patient_id = mdsepid) %>%
#   mutate(drug_ever = case_when(
#     !is.na(med_name)            ~ "Yes",
#     !is.na(med_start_dt)        ~ "Yes"
#   )) %>%
#   group_by(patient_id) %>%
#   fill(drug_ever, .direction = "updown") %>%
#   ungroup() %>%
#   filter(is.na(drug_ever))
# 
# b12_excluded <- data %>%
#   filter(str_detect(patient_id, paste0(b12_excluded$patient_id, collapse = "|")))
```

```{r}
mut_group <- data %>% 
  left_join(., med_data %>% 
              select(mdsepid, b12_supplement) %>% 
              distinct(),
            by = c("patient_id" = "mdsepid")) %>% 
  select(patient_id, gene, everything()) %>%
  # filter(!is.na(gene)) %>%
  distinct(patient_id, gene, .keep_all = TRUE) %>% 
  filter(b12_supplement == "No")


mut_group <- mut_group %>% 
  dummy_cols(select_columns = "gene") %>% 
  select(-gene) %>% 
  mutate(across(starts_with("gene"), ~ na_if(., 0))) %>% 
  group_by(patient_id) %>% 
  fill(everything(), .direction = "updown") %>% 
  ungroup() %>% 
  distinct(patient_id, .keep_all = TRUE) %>% 
  mutate(across(starts_with("gene"), .fns = ~ replace_na(., 0))) %>% 
  rename(ICUS = gene_NA)

mut_group1 <- mut_group %>% 
  mutate(TET2_vs_CCUS_ICUS = case_when(
    ICUS == 1                              ~ "ICUS",
    gene_TET2 == 1                         ~ "TET2",
    if_any(starts_with("gene")) == 1       ~ "CCUS",
  ), TET2_vs_CCUS_ICUS = factor(TET2_vs_CCUS_ICUS, 
                                levels = c("TET2", "CCUS", "ICUS"))) %>% 
  mutate(DTA_vs_CCUS_ICUS = case_when(
    ICUS == 1                              ~ "ICUS",
    gene_TET2 == 1 |
      gene_ASXL1 == 1 |
      gene_DNMT3A == 1                       ~ "DTA",
    if_any(starts_with("gene")) == 1       ~ "CCUS",
  ), DTA_vs_CCUS_ICUS = factor(DTA_vs_CCUS_ICUS, 
                                levels = c("DTA", "CCUS", "ICUS"))) %>% 
  mutate(DT_vs_CCUS_ICUS = case_when(
    ICUS == 1                              ~ "ICUS",
    gene_TET2 == 1 |
      gene_DNMT3A == 1                       ~ "DT",
    if_any(starts_with("gene")) == 1       ~ "CCUS",
  ), DT_vs_CCUS_ICUS = factor(DT_vs_CCUS_ICUS, 
                                levels = c("DT", "CCUS", "ICUS"))) %>% 
  mutate(DNAdamage_vs_CCUS_ICUS = case_when(
    ICUS == 1                              ~ "ICUS",
    gene_TP53 == 1 |
      # gene_CHECK2 == 1 |
      gene_PPM1D == 1                        ~ "DNA_damage",
    if_any(starts_with("gene")) == 1       ~ "CCUS",
  ), DNAdamage_vs_CCUS_ICUS = factor(DNAdamage_vs_CCUS_ICUS, 
                                levels = c("DNA_damage", "CCUS", "ICUS"))) %>% 
  # mutate(rs = rowSums(select(.,starts_with("gene")), na.rm = TRUE)) %>% 
  select(patient_id, # rs, 
         TET2_vs_CCUS_ICUS, starts_with("gene"), 
         ICUS, everything())
```

## Table 1
```{r}
mut_group1 %>% 
  distinct(patient_id, .keep_all = TRUE) %>% 
  select(age, sex,
         bmi, bmi_cat,
         mma_um, mma_cat,
         baseline_b12_serum, 
         b12_interpretation, 
         baseline_creatinine_serum,
         renal_disease,
         calculated_CrCl,
         CrCl_interpretation,
         group) %>% 
  tbl_summary(by = group) %>% 
  bold_labels() %>% add_overall() %>% 
  add_p() %>% bold_p(t = 0.05)
```

## TET2_vs_CCUS_vs_ICUS
```{r}
mut_group1 %>% 
  select(
         mma_um, mma_cat,
         baseline_b12_serum, 
         b12_interpretation, 
         TET2_vs_CCUS_ICUS) %>% 
  tbl_summary(by = TET2_vs_CCUS_ICUS) %>% 
  bold_labels() %>% add_overall() %>% 
  add_p() %>% bold_p(t = 0.05)
```

## TET2_vs_CCUS+ICUS
```{r}
mut_group1 %>% 
  mutate(TET2_vs_CCUS_ICUS = case_when(
    TET2_vs_CCUS_ICUS == "ICUS" |
      TET2_vs_CCUS_ICUS == "CCUS"          ~ "ICUS + No TET2 CCUS",
    TET2_vs_CCUS_ICUS == "TET2"            ~ "TET2"
  ), TET2_vs_CCUS_ICUS = factor(TET2_vs_CCUS_ICUS, 
                                levels = c("TET2", "ICUS + No TET2 CCUS"))) %>% 
  select(
         mma_um, mma_cat,
         baseline_b12_serum, 
         b12_interpretation, 
         TET2_vs_CCUS_ICUS) %>% 
  tbl_summary(by = TET2_vs_CCUS_ICUS) %>% 
  bold_labels() %>% add_overall() %>% 
  add_p() %>% bold_p(t = 0.05)
```

## DTA_vs_CCUS_vs_ICUS
```{r}
mut_group1 %>% 
  select(
         mma_um, mma_cat,
         baseline_b12_serum, 
         b12_interpretation, 
         DTA_vs_CCUS_ICUS) %>% 
  tbl_summary(by = DTA_vs_CCUS_ICUS) %>% 
  bold_labels() %>% add_overall() %>% 
  add_p() %>% bold_p(t = 0.05)
```

## DTA_vs_CCUS+ICUS
```{r}
mut_group1 %>% 
  mutate(DTA_vs_CCUS_ICUS = case_when(
    DTA_vs_CCUS_ICUS == "ICUS" |
      DTA_vs_CCUS_ICUS == "CCUS"          ~ "ICUS + No DTA CCUS",
    DTA_vs_CCUS_ICUS == "DTA"            ~ "DTA"
  ), DTA_vs_CCUS_ICUS = factor(DTA_vs_CCUS_ICUS, 
                                levels = c("DTA", "ICUS + No DTA CCUS"))) %>% 
  select(
         mma_um, mma_cat,
         baseline_b12_serum, 
         b12_interpretation, 
         DTA_vs_CCUS_ICUS) %>% 
  tbl_summary(by = DTA_vs_CCUS_ICUS) %>% 
  bold_labels() %>% add_overall() %>% 
  add_p() %>% bold_p(t = 0.05)
```

## DT_vs_CCUS_vs_ICUS
```{r}
mut_group1 %>% 
  select(
         mma_um, mma_cat,
         baseline_b12_serum, 
         b12_interpretation, 
         DT_vs_CCUS_ICUS) %>% 
  tbl_summary(by = DT_vs_CCUS_ICUS) %>% 
  bold_labels() %>% add_overall() %>% 
  add_p() %>% bold_p(t = 0.05)
```

## DT_vs_CCUS+ICUS
```{r}
mut_group1 %>% 
  mutate(DT_vs_CCUS_ICUS = case_when(
    DT_vs_CCUS_ICUS == "ICUS" |
      DT_vs_CCUS_ICUS == "CCUS"          ~ "ICUS + No DT CCUS",
    DT_vs_CCUS_ICUS == "DT"            ~ "DT"
  ), DT_vs_CCUS_ICUS = factor(DT_vs_CCUS_ICUS, 
                                levels = c("DT", "ICUS + No DT CCUS"))) %>% 
  select(
         mma_um, mma_cat,
         baseline_b12_serum, 
         b12_interpretation, 
         DT_vs_CCUS_ICUS) %>% 
  tbl_summary(by = DT_vs_CCUS_ICUS) %>% 
  bold_labels() %>% add_overall() %>% 
  add_p() %>% bold_p(t = 0.05)
```

## DNA_damage_vs_CCUS_vs_ICUS
```{r}
mut_group1 %>% 
  select(
         mma_um, mma_cat,
         baseline_b12_serum, 
         b12_interpretation, 
         DNAdamage_vs_CCUS_ICUS) %>% 
  tbl_summary(by = DNAdamage_vs_CCUS_ICUS) %>% 
  bold_labels() %>% add_overall() %>% 
  add_p() %>% bold_p(t = 0.05)
```

## DNA_damage_vs_CCUS+ICUS
```{r}
mut_group1 %>% 
  mutate(DNAdamage_vs_CCUS_ICUS = case_when(
    DNAdamage_vs_CCUS_ICUS == "ICUS" |
      DNAdamage_vs_CCUS_ICUS == "CCUS"          ~ "ICUS + No DNA_damage CCUS",
    DNAdamage_vs_CCUS_ICUS == "DNA_damage"            ~ "DNA_damage"
  ), DNAdamage_vs_CCUS_ICUS = factor(DNAdamage_vs_CCUS_ICUS, 
                                levels = c("DNA_damage", "ICUS + No DNA_damage CCUS"))) %>% 
  select(
         mma_um, mma_cat,
         baseline_b12_serum, 
         b12_interpretation, 
         DNAdamage_vs_CCUS_ICUS) %>% 
  tbl_summary(by = DNAdamage_vs_CCUS_ICUS) %>% 
  bold_labels() %>% add_overall() %>% 
  add_p() %>% bold_p(t = 0.05)
```

<!-- ## I. Table 1 - Clinical -->
<!-- ```{r} -->
<!-- b12_excluded %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   select(age, sex, -->
<!--          bmi, bmi_cat, -->
<!--          mma_um, mma_cat, -->
<!--          baseline_b12_serum,  -->
<!--          b12_interpretation,  -->
<!--          baseline_creatinine_serum, -->
<!--          renal_disease, -->
<!--          calculated_CrCl, -->
<!--          CrCl_interpretation, -->
<!--          group) %>%  -->
<!--   tbl_summary(by = group) %>%  -->
<!--   bold_labels() %>% add_overall() %>%  -->
<!--   add_p() %>% bold_p(t = 0.05) -->
<!-- ``` -->

<!-- ## II. Table 2 - Variant -->
<!-- ### ALL variants of all patients -->
<!-- The patient previously categorized as ICUS was excluded. -->
<!-- ```{r} -->
<!-- b12_excluded %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   select(variant_confidence_level, -->
<!--          group) %>%  -->
<!--   tbl_summary(by = group) %>%  -->
<!--   bold_labels() %>% add_overall() %>%  -->
<!--   add_p() %>% bold_p(t = 0.05) -->

<!-- # b12_excluded %>%  -->
<!-- #   filter(variant_confidence_level == "Level 1 (Manually Curated)" & -->
<!-- #            group == "ICUS_GROUP") %>%  -->
<!-- #   select(patient_id, group, -->
<!-- #          gene : variant_confidence_level,  -->
<!-- #          everything()) -->
<!-- ``` -->

<!-- ### Mutations count summarized by gene -->
<!-- ```{r} -->
<!-- library(fastDummies) -->
<!-- dum <- b12_excluded %>%  -->
<!--   select(patient_id, gene) %>%  -->
<!--   filter(!is.na(gene)) %>%  -->
<!--   distinct(patient_id, gene) -->
<!-- dum %>%  -->
<!--   dummy_cols(select_columns = "gene") %>%  -->
<!--   select(-gene) %>%  -->
<!--   mutate(across(starts_with("gene"), ~ na_if(., 0))) %>%  -->
<!--   group_by(patient_id) %>%  -->
<!--   fill(everything(), .direction = "updown") %>%  -->
<!--   ungroup() %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   mutate(across(starts_with("gene"), .fns = ~ replace_na(., 0))) %>%  -->
<!--   select(-patient_id) %>%  -->
<!--   `colnames<-`(str_remove(colnames(.), "gene_")) %>%  -->
<!--   tbl_summary(sort = everything() ~ "frequency") %>%  -->
<!--   bold_labels() -->
<!-- ``` -->

<!-- ## III. Explore previous analysis -->
<!-- ### 1. CCUS vs. ICUS -->
<!-- <div class = "row"> -->
<!-- <div class = "col-md-6"> -->
<!-- MMA -->
<!-- ```{r} -->
<!-- b12_excluded %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   ggplot(aes(x = group, y = mma_um))+ -->
<!--   geom_violin()+ -->
<!--   geom_jitter(color="grey")+ -->
<!--   geom_boxplot(width=0.1, outlier.shape = NA)+ -->
<!--   labs(x = NULL, y = "MMA (µM)") -->

<!-- b12_excluded %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   select(group, mma_um, mma_cat) %>%  -->
<!--   tbl_summary(by = group) %>%  -->
<!--   bold_labels() %>%  -->
<!--   add_p() %>% bold_p(t = 0.05) -->
<!-- ``` -->
<!-- </div> -->

<!-- <div class = "col-md-6"> -->

<!-- </div> -->
<!-- </div> -->


<!-- ### 2. Age -->
<!-- <div class = "row"> -->
<!-- <div class = "col-md-6"> -->
<!-- MMA -->
<!-- ```{r} -->
<!-- b12_excluded %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   ggplot(aes(x = age, y = mma_um))+ -->
<!--   geom_point(aes(color = age_cat))+ -->
<!--   geom_smooth(method = "lm", se=FALSE, color="black", formula = y ~ x) + -->
<!--   stat_cor(label.y = 1)+  -->
<!--   stat_regline_equation(label.y = 0.75)+ -->
<!--   labs(x = "Age (continuous)", y = "MMA (µM)") -->

<!-- b12_excluded %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   select(age_cat, mma_um, mma_cat) %>%  -->
<!--   tbl_summary(by = age_cat) %>%  -->
<!--   bold_labels() %>%  -->
<!--   add_p() %>% bold_p(t = 0.05) -->
<!-- ``` -->
<!-- </div> -->

<!-- <div class = "col-md-6"> -->

<!-- </div> -->
<!-- </div> -->



<!-- ### 4. Sex -->
<!-- <div class = "row"> -->
<!-- <div class = "col-md-6"> -->
<!-- MMA -->
<!-- ```{r} -->
<!-- b12_excluded %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   ggplot(aes(x = sex, y = mma_um))+ -->
<!--   geom_violin()+ -->
<!--   geom_jitter(color="grey")+ -->
<!--   geom_boxplot(width=0.1, outlier.shape = NA)+ -->
<!--   labs(x = NULL, y = "MMA (µM)") -->

<!-- b12_excluded %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   select(sex, mma_um, mma_cat) %>%  -->
<!--   tbl_summary(by = sex) %>%  -->
<!--   bold_labels() %>%  -->
<!--   add_p() %>% bold_p(t = 0.05) -->
<!-- ``` -->
<!-- </div> -->

<!-- <div class = "col-md-6"> -->

<!-- </div> -->
<!-- </div> -->

<!-- ## IV. New analysis -->


<!-- ### 2. Stratified by age -->
<!-- <div class = "row"> -->
<!-- <div class = "col-md-6"> -->
<!-- MMA -->
<!-- ```{r, fig.height=8} -->
<!-- b12_excluded %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   ggplot(aes(x = age, y = mma_um))+ -->
<!--   geom_point(aes(color = age_cat2))+ -->
<!--   geom_smooth(method = "lm", se=FALSE, color="black", formula = y ~ x) + -->
<!--   stat_cor(label.y = 1)+  -->
<!--   stat_regline_equation(label.y = 0.75)+ -->
<!--   labs(x = "Age", y = "MMA (µM)")+ -->
<!--   facet_wrap(. ~ age_cat2, ncol = 1) -->

<!-- b12_excluded %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   select(age_cat2, mma_um, mma_cat) %>%  -->
<!--   tbl_summary(by = age_cat2) %>%  -->
<!--   bold_labels() %>%  -->
<!--   add_p() %>% bold_p(t = 0.05) -->
<!-- ``` -->
<!-- </div> -->

<!-- <div class = "col-md-6"> -->

<!-- </div> -->
<!-- </div> -->


<!-- <div class = "row"> -->
<!-- <div class = "col-md-6"> -->
<!-- MMA -->
<!-- ```{r} -->
<!-- b12_excluded %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   filter(age > 50) %>%  -->
<!--   ggplot(aes(x = age, y = mma_um))+ -->
<!--   geom_point(color = "purple")+ -->
<!--   geom_smooth(method = "lm", se=FALSE, color="black", formula = y ~ x) + -->
<!--   stat_cor(label.y = 1)+  -->
<!--   stat_regline_equation(label.y = 0.75)+ -->
<!--   labs(x = "Age", y = "MMA (µM)") -->

<!-- b12_excluded %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   filter(age > 60) %>%  -->
<!--   ggplot(aes(x = age, y = mma_um))+ -->
<!--   geom_point(color = "purple")+ -->
<!--   geom_smooth(method = "lm", se=FALSE, color="black", formula = y ~ x) + -->
<!--   stat_cor(label.y = 1)+  -->
<!--   stat_regline_equation(label.y = 0.75)+ -->
<!--   labs(x = "Age", y = "MMA (µM)") -->

<!-- b12_excluded %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   filter(age > 65) %>%  -->
<!--   ggplot(aes(x = age, y = mma_um))+ -->
<!--   geom_point(color = "purple")+ -->
<!--   geom_smooth(method = "lm", se=FALSE, color="black", formula = y ~ x) + -->
<!--   stat_cor(label.y = 1)+  -->
<!--   stat_regline_equation(label.y = 0.75)+ -->
<!--   labs(x = "Age", y = "MMA (µM)") -->
<!-- ``` -->
<!-- </div> -->

<!-- <div class = "col-md-6"> -->

<!-- </div> -->
<!-- </div> -->

<!-- ### 3. Stratified by Sex -->
<!-- #### Male -->
<!-- ```{r} -->
<!-- b12_excluded %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   filter(sex == "Male") %>%  -->
<!--   select(mma_um, mma_cat, -->
<!--          group) %>%  -->
<!--   tbl_summary(by = group) %>%  -->
<!--   bold_labels() %>% add_overall() %>%  -->
<!--   add_p() %>% bold_p(t = 0.05) -->
<!-- ``` -->




<!-- #### Female -->
<!-- ```{r} -->
<!-- b12_excluded %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   filter(sex == "Female") %>%  -->
<!--   select(mma_um, mma_cat, -->
<!--          group) %>%  -->
<!--   tbl_summary(by = group) %>%  -->
<!--   bold_labels() %>% add_overall() %>%  -->
<!--   add_p() %>% bold_p(t = 0.05) -->
<!-- ``` -->



<!-- ## 3. Stratified by group -->
<!-- ### ICUS -->
<!-- ```{r} -->
<!-- b12_excluded %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   filter(group == "ICUS_GROUP") %>%  -->
<!--   select(mma_um, mma_cat, -->
<!--          sex) %>%  -->
<!--   tbl_summary(by = sex) %>%  -->
<!--   bold_labels() %>% add_overall() %>%  -->
<!--   add_p() %>% bold_p(t = 0.05) -->
<!-- ``` -->




<!-- ### CCUS -->
<!-- ```{r} -->
<!-- b12_excluded %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   filter(group == "CCUS_GROUP") %>%  -->
<!--   select(mma_um, mma_cat, -->
<!--          sex) %>%  -->
<!--   tbl_summary(by = sex) %>%  -->
<!--   bold_labels() %>% add_overall() %>%  -->
<!--   add_p() %>% bold_p(t = 0.05) -->
<!-- ``` -->



<!-- ### 5. MMA & B12 -->
<!-- ```{r} -->
<!-- b12_excluded %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   ggplot(aes(x = baseline_b12_serum, y = mma_um))+ -->
<!--   geom_point(color = "blue")+ -->
<!--   geom_smooth(method = "lm", se=FALSE, color="black", formula = y ~ x) + -->
<!--   stat_cor(label.y = 1)+  -->
<!--   stat_regline_equation(label.y = 0.75)+ -->
<!--   labs(x = "Baseline B12 (pg/mL)", y = "MMA (µM)") -->

<!-- b12_excluded %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   filter(!is.na(b12_interpretation)) %>%  -->
<!--   ggplot(aes(x = b12_interpretation, y = mma_um))+ -->
<!--   geom_boxplot()+ -->
<!--   geom_jitter(color="grey") -->

<!-- b12_excluded %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   select(b12_interpretation, mma_um) %>%  -->
<!--   tbl_summary(by = b12_interpretation) %>%  -->
<!--   bold_labels() %>%  -->
<!--   add_p() %>% bold_p(t = 0.05) -->
<!-- ``` -->

<!-- ### 6. MMA & kidney function (renal disease) -->
<!-- <div class = "row"> -->
<!-- <div class = "col-md-6"> -->
<!-- ```{r} -->
<!-- b12_excluded %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   filter(!is.na(renal_disease)) %>%  -->
<!--   ggplot(aes(x = renal_disease, y = mma_um))+ -->
<!--   geom_violin()+ -->
<!--   geom_jitter(color="grey")+ -->
<!--   geom_boxplot(width=0.1, outlier.shape = NA) -->

<!-- b12_excluded %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   select(renal_disease, mma_um) %>%  -->
<!--   tbl_summary(by = renal_disease) %>%  -->
<!--   bold_labels() %>%  -->
<!--   add_p() %>% bold_p(t = 0.05) -->
<!-- ``` -->
<!-- </div> -->

<!-- <div class = "col-md-6"> -->
<!-- ```{r} -->
<!-- b12_excluded %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   filter(!is.na(CrCl_interpretation)) %>%  -->
<!--   ggplot(aes(x = CrCl_interpretation, y = mma_um))+ -->
<!--   geom_violin()+ -->
<!--   geom_jitter(color="grey")+ -->
<!--   geom_boxplot(width=0.1, outlier.shape = NA) -->

<!-- b12_excluded %>%  -->
<!--   distinct(patient_id, .keep_all = TRUE) %>%  -->
<!--   select(CrCl_interpretation, mma_um) %>%  -->
<!--   tbl_summary(by = CrCl_interpretation) %>%  -->
<!--   bold_labels() %>%  -->
<!--   add_p() %>% bold_p(t = 0.05) -->
<!-- ``` -->
<!-- </div> -->
<!-- </div> -->



