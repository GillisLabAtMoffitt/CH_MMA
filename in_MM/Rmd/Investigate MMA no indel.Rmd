---
title: "Investigate MMA = CH no indel in Multiple Myeloma"
author: "Christelle Colin-Leitzinger"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: yes
    toc_float: yes
    toc_collapsed: no
    theme: cerulean
    highlight: pygments
    df_print: paged
editor_options:
  chunk_output_type: console
---

<style type="text/css">
h1.title {
  font-size: 25px;
}
.figure {
   margin-top: 25px;
   margin-bottom: 25px;
}

table {
    margin-top: 25px;
    margin-bottom: 25px !important;
}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      message = FALSE,
                      cache = FALSE,
                      fig.align='center'
                      )
```


<style>
div.blue { background-color:#0099CC; border-radius: 5px; padding: 20px; font-size: 38px}
</style>
<div class = "blue">

<span style="color: white;">Investigate MMA in Multiple Myeloma</span>

</div>
<br>

```{r library, include=FALSE}
library(tidyverse)
library(data.table)
library(VennDiagram)
library(viridis)
library(lubridate)
library(gtsummary)
library(survival)
library(survminer)
theme_gtsummary_compact()
theme_set(theme_classic())
```

We had 5 patients with tumor samples contamination that we removed from the following analyses.
```{r load}
contamination_tumor_ids <- paste("A025767", "A025771", "A007368", "A007322", "A000111", sep = "|")

germline_patient_data <- 
  readRDS("/Users/colinccm/Documents/GitHub/CHIP-Avatar/germline_patient_data.rds") %>% 
  mutate(mrn.x = as.character(mrn.x)) %>% 
  mutate(mrn.y = as.character(mrn.y)) %>% 
  mutate(MRN = coalesce(MRN, mrn.x, mrn.y)) %>% 
  select(-c(mrn.x, mrn.y)) %>% 
  # Include only patients that are MM
  filter(is_patient_MM == "Yes") %>% 
  # Remove patients with contaminated tumor sample
  filter(!str_detect(avatar_id, contamination_tumor_ids))

path <- fs::path("","Volumes","Gillis_Research","Christelle Colin-Leitzinger", "CH and MMA")

no_indel_CH_status <- 
  read_csv(paste0(path, "/data/CHcalls_woINDELS_7.7.22_list_Christelle.csv"), 
           col_select = c(patient_id, CH_status),
           n_max = 651) %>% 
  mutate(patient_id = str_remove(patient_id, "_normal"))

ch_genes <- read_csv(paste0(path, "/data/CHcalls_woINDELS_7.7.22_muts_Christelle.csv")) %>% 
  mutate(patient_id = str_remove(patient_id, "_normal")) %>% 
  filter(`...2` == "CH") %>% 
  # mutate(across(where(is.numeric), ~ na_if(., "\\."))) %>%
  # mutate(across(where(is.character), ~ str_replace(., "\\.", NA_character_))) %>% 
  arrange(patient_id, GENE, desc(VAF_normal)) %>% 
  # Keep 1 mutation per gene
  distinct(patient_id, GENE, .keep_all = TRUE)

# Load MRN
IDs_list <- readxl::read_xlsx(here::here("MMA_avatar_lab_report.xlsx"), 
                              sheet = "IDs list") %>%
  mutate(PATIENT_ID = as.character(PATIENT_ID)) %>%
  mutate(MRN = as.character(MRN))

# Load EGFR and more
creatinine <- readxl::read_xlsx(here::here("MMA_avatar_lab_report_V2.xlsx"), 
                                sheet = "Updated_Lab_Creatinine") %>%
  left_join(IDs_list, .,
            by = "PATIENT_ID") %>%
  filter(str_detect(LAB_RESULT, "\\d+ ?")) %>%
  # mutate(LAB_RESULT = as.numeric(LAB_RESULT)) %>%
  filter(!is.na(LAB_RESULT) & SPECIMEN_TYPE == "Blood")
bmi <- readxl::read_xlsx(here::here("MMA_avatar_lab_report.xlsx"), 
                         sheet = "BMI") %>%
  left_join(IDs_list, .,
            by = "PATIENT_ID") %>%
  filter(str_detect(VITALS_VALUE, "\\d+ ?"))
height <- readxl::read_xlsx(here::here("MMA_avatar_lab_report.xlsx"), 
                            sheet = "Height") %>%
  filter(str_detect(VITALS_UNITS, "cm|in")) %>%
  left_join(IDs_list, .,
            by = "PATIENT_ID") %>%
  filter(str_detect(VITALS_VALUE, "\\d+ ?")) %>%
  mutate(VITALS_VALUE = as.numeric(VITALS_VALUE)) %>%
  # Convert values to meter
  mutate(VITALS_VALUE = case_when(
    VITALS_UNITS == "cm"              ~ VITALS_VALUE / 100,
    str_detect(VITALS_UNITS, "in")    ~ VITALS_VALUE / 39.37
  ), height_unit = "m")
weight <- readxl::read_xlsx(here::here("MMA_avatar_lab_report.xlsx"), 
                            sheet = "Weight") %>%
  filter(str_detect(VITALS_VALUE, "\\d+ ?") &
           !str_detect(VITALS_VALUE, "Not Done")) %>%
  mutate(VITALS_VALUE = as.numeric(VITALS_VALUE)) %>%
  filter(VITALS_VALUE > 0) %>%
  left_join(IDs_list, .,
            by = "PATIENT_ID")
# egfr <- readxl::read_xlsx("egfr in Avatar patients.xlsx") %>%
#   filter(str_detect(LAB_RESULT, "\\d+ ?")) %>%
#   mutate(MRN = as.character(MRN))
# egfr_Yifen <- readxl::read_xlsx(here::here("MMA_avatar_lab_report_V2.xlsx"), sheet = "Updated_Lab_eGFR") %>%
#   left_join(IDs_list, .,
#             by = "PATIENT_ID") %>%
#   filter(str_detect(LAB_RESULT, "\\d+ ?"))
b12 <- readxl::read_xlsx(here::here("Vit b12 in Avatar patients.xlsx")) %>%
  filter(!is.na(LAB_RESULT)) %>%
  mutate(MRN = as.character(MRN))
b12_Yifen <- readxl::read_xlsx(here::here("MMA_avatar_lab_report.xlsx"), 
                               sheet = "Lab_B12") %>%
  left_join(IDs_list, .,
            by = "PATIENT_ID") %>%
  filter(!is.na(LAB_RESULT))
MMA_2 <- readxl::read_xlsx(here::here("MMA_avatar_lab_report.xlsx"), 
                           sheet = "Lab_MMA") %>%
  left_join(IDs_list, .,
            by = "PATIENT_ID") %>%
  filter(!is.na(LAB_RESULT))
```

```{r new CH status}
germline_patient_data <- germline_patient_data %>%
  left_join(., no_indel_CH_status %>%
              rename(CH_status_no_indel = CH_status),
            by = c("SLID_germline" = "patient_id")) %>% 
  mutate(#CH_status_no_indel = case_when(
  #   CH_status_no_indel == "CH"            ~ "CH",
  #   CH_status == "No CH"                  ~ "No CH"
  # ),
  CH_status_no_indel = factor(CH_status_no_indel, 
                                levels = c("No_CH", "CH")))
```

```{r clean BMI}
germline_patient_data <- germline_patient_data %>%
  left_join(., bmi %>%
              select(MRN, VITALS_VALUE, VITALS_DTM),
            by = "MRN") %>%
  mutate(VITALS_VALUE = as.numeric(VITALS_VALUE)) %>% 
  # Create var closest bmi results to germline
  mutate(int = abs(interval(start = VITALS_DTM,
                            end = collectiondt_germline) /
                     duration(n=1, units = "days"))) %>%
  group_by(avatar_id, collectiondt_germline) %>%
  mutate(min = min(int)) %>%
  mutate(bmi_germline_results = case_when(
    min == int               ~ VITALS_VALUE,
    TRUE                     ~ NA_real_
  )) %>%
  mutate(bmi_date = case_when(
    min == int               ~ VITALS_DTM,
    TRUE                     ~ NA_POSIXct_
  )) %>%
  # Pick 1 value per patient
  fill(#bmi_MMdx_results, 
       bmi_germline_results, bmi_date,
       .direction = "updown") %>%
  ungroup() %>%
  select(-c(VITALS_VALUE, VITALS_DTM)) %>%
  distinct(avatar_id, .keep_all = TRUE)

# Height
germline_patient_data <- germline_patient_data %>%
  left_join(., height %>%
              select(MRN, VITALS_VALUE, VITALS_UNITS, VITALS_DTM),
            by = "MRN") %>%
  # Create var closest height results to germline
  mutate(int = abs(interval(start = VITALS_DTM,
                            end = collectiondt_germline) /
                     duration(n=1, units = "days"))) %>%
  group_by(avatar_id, collectiondt_germline) %>%
  mutate(min = min(int)) %>%
  mutate(height_germline_results = case_when(
    min == int               ~ VITALS_VALUE,
    TRUE                     ~ NA_real_
  )) %>%
  mutate(height_date = case_when(
    min == int               ~ VITALS_DTM,
    TRUE                     ~ NA_POSIXct_
  )) %>%
  # Pick 1 value per patient
  fill(#height_MMdx_results, 
       height_germline_results, height_date,
       .direction = "updown") %>%
  ungroup() %>%
  select(-c(VITALS_VALUE, VITALS_UNITS, VITALS_DTM)) %>%
  distinct(avatar_id, .keep_all = TRUE)

# Weight
germline_patient_data <- germline_patient_data %>%
  left_join(., weight %>%
              select(MRN, VITALS_VALUE, VITALS_UNITS, VITALS_DTM) %>%
              filter(!is.na(VITALS_VALUE)),
            by = "MRN") %>%
  # Convert values to meter
  mutate(VITALS_VALUE = case_when(
    VITALS_UNITS == "lb"              ~ VITALS_VALUE / 2.205
    ), weight_unit = "kg") %>% 
  
  # Create var closest weight results to germline
  mutate(int = abs(interval(start = VITALS_DTM,
                            end = collectiondt_germline) /
                     duration(n=1, units = "days"))) %>%
  group_by(avatar_id, collectiondt_germline) %>%
  mutate(min = min(int)) %>%
  mutate(weight_germline_results = case_when(
    min == int               ~ VITALS_VALUE,
    TRUE                     ~ NA_real_
  )) %>%
  mutate(weight_date = case_when(
    min == int               ~ VITALS_DTM,
    TRUE                     ~ NA_POSIXct_
  )) %>%
  # Pick 1 value per patient
  fill(#weight_MMdx_results, 
       weight_germline_results, weight_date,
       .direction = "updown") %>%
  ungroup() %>%
  select(-c(VITALS_VALUE, VITALS_UNITS, VITALS_DTM, int, min)) %>%
  distinct(avatar_id, .keep_all = TRUE)

# BMI calculation for rescue
germline_patient_data <- germline_patient_data %>%
  mutate(calculated_bmi = 
           weight_germline_results / 
           (height_germline_results * height_germline_results)) %>% 
  mutate(bmi_combined = coalesce(bmi_germline_results, calculated_bmi))
# OR
# germline_patient_data1 <- germline_patient_data %>%
#   mutate(calculated_bmi = 
#            weight_germline_results / 
#            (height_germline_results * height_germline_results)) %>% 
#   pivot_longer(cols = c(calculated_bmi, bmi_germline_results),
#              names_to = "bmi_data", values_to = "bmi_germline_results", values_drop_na = TRUE) %>%
#   mutate(bmi_date = case_when(
#     bmi_data == "bmi_germline_results"     ~ bmi_date,
#     bmi_data == "calculated_bmi"           ~ weight_date
#   )) %>% 
#   arrange(avatar_id, bmi_date) %>% 
#   distinct(avatar_id, .keep_all = TRUE)

```

Creatinine clean up:   
-creatinine_germline_results < 0.7 -----> 0.7

CrCl:   
No capping at 125
```{r clean creatinine}
germline_patient_data <- germline_patient_data %>%
  left_join(., creatinine %>%
              select(MRN, LAB_RESULT, LAB_UNIT, EVENT_START_DTM) %>%
              filter(!is.na(LAB_RESULT)),
            by = "MRN") %>%
  # Create var closest creatinine results to germline
  mutate(int = abs(interval(start = EVENT_START_DTM,
                            end = collectiondt_germline) /
                     duration(n=1, units = "days"))) %>%
  group_by(avatar_id, collectiondt_germline) %>%
  mutate(min = min(int)) %>%
  mutate(creatinine_germline_results = case_when(
    min == int               ~ LAB_RESULT,
    TRUE                     ~ NA_character_
  )) %>%
  mutate(creatinine_date = case_when(
    min == int               ~ EVENT_START_DTM,
    TRUE                     ~ NA_POSIXct_
  )) %>%
  # Pick 1 value per patient
  fill(#creatinine_MMdx_results,
       creatinine_germline_results, creatinine_date,
       .direction = "updown") %>%
  ungroup() %>%
  select(-c(LAB_RESULT, EVENT_START_DTM, int, min), creatinine_unit = LAB_UNIT) %>%
  distinct(avatar_id, .keep_all = TRUE) %>% 
  # Calculate age at creatinine
  mutate(age_at_creatinine = round(interval(start = Date_of_Birth, end = creatinine_date)/
                                    duration(n = 1, units = "years"), 1)
  ) 

germline_patient_data <- germline_patient_data %>%
  mutate(creatinine_germline_results = as.numeric(creatinine_germline_results),
         creatinine_germline_results = case_when(
           creatinine_germline_results < 0.7      ~ 0.7,
           TRUE                                   ~ creatinine_germline_results
         ))

germline_patient_data <- germline_patient_data %>%
# Calculate ideal dody weight
# Males: IBW = 50 kg + 2.3 kg for each inch over 5 feet.
# Females: IBW = 45.5 kg + 2.3 kg for each inch over 5 feet.
  # Need height closest to creatinine
  left_join(., height %>%
              select(MRN, VITALS_VALUE, VITALS_DTM),
            by = "MRN") %>%
  # Create var closest height results to germline
  mutate(int = abs(interval(start = VITALS_DTM,
                            end = creatinine_date) /
                     duration(n=1, units = "days"))) %>%
  arrange(avatar_id, int) %>%
  select(-c(VITALS_DTM), height_at_creat = VITALS_VALUE) %>%
  distinct(avatar_id, .keep_all = TRUE) %>% 
  # Need weight closest to creatinine
  left_join(., weight %>%
              select(MRN, VITALS_VALUE, VITALS_DTM),
            by = "MRN") %>%
  # Create var closest weight results to germline
  mutate(int = abs(interval(start = VITALS_DTM,
                            end = creatinine_date) /
                     duration(n=1, units = "days"))) %>%
  arrange(avatar_id, int) %>%
  select(-c(VITALS_DTM, int), weight_at_creat = VITALS_VALUE) %>%
  distinct(avatar_id, .keep_all = TRUE) %>% 
  # Calculate bmi at creatinine
  mutate(bmi_at_creatinine = 
           weight_at_creat / 
           (height_at_creat * height_at_creat)) %>% 
  
  # Now can Calculate ideal dody weight
  mutate(ideal_weight = case_when(
    Sex == "Female" &
      height_at_creat <= 1.524               ~ 45.5 + 2.3,
    Sex == "Female" &
      height_at_creat > 1.524                ~ 45.5 + (2.3 * (((height_at_creat - 1.524) / 0.0254))),
    Sex == "Male" &
      height_at_creat <= 1.524               ~ 50 + 2.3,
    Sex == "Male" &
      height_at_creat > 1.524                ~ 50 + (2.3 * (((height_at_creat - 1.524) / 0.0254)))
  )) %>% 
  mutate(adjusted_weight = ((weight_at_creat - ideal_weight) * 0.40) + ideal_weight
  ) %>%
  # Calculate CrCl
  mutate(CrCl = case_when(
    Sex == "Female"                   ~ ((
      ((140 - age_at_creatinine) * weight_at_creat) /
        (72 * creatinine_germline_results)) * 
        0.85),
    
    Sex == "Male"                     ~ (
      ((140 - age_at_creatinine) * weight_at_creat) / 
        (72 * creatinine_germline_results)
      )
  ),
  CrCl = round(CrCl, 0)) %>% 
  
  mutate(adjusted_CrCl = case_when(
    Sex == "Female"                   ~ ((
      ((140 - age_at_creatinine) * adjusted_weight) /
        (72 * creatinine_germline_results)) * 
        0.85),
    
    Sex == "Male"                     ~ (
      ((140 - age_at_creatinine) * adjusted_weight) / 
        (72 * creatinine_germline_results)
      )
  ),
  adjusted_CrCl = round(adjusted_CrCl, 0)) %>% 

  mutate(calculated_CrCl = case_when(
    bmi_at_creatinine >= 25                 ~ adjusted_CrCl,
    bmi_at_creatinine < 25                  ~ CrCl
  )) %>% 
  mutate(CrCl_units = "mL/min/1.73m2") %>% 
  mutate(CrCl_interpretation = case_when(
    calculated_CrCl < 60                    ~ "Low",
    calculated_CrCl >= 60                   ~ "Normal"
  ))
```

B12 clean up:   
-if value    
```{r, echo=TRUE}
# b12_value > 999 &   
#       b12_value <= 1999                    ~ 1500,   
#   b12_value > 1999                         ~ 2500,
```

```{r clean b12}
b12_ <- bind_rows(b12 %>%
              select(MRN, LAB_RESULT, LAB_UNIT, EVENT_START_DTM, NORMALCY),
                     b12_Yifen %>%
              select(MRN, LAB_RESULT, LAB_UNIT, EVENT_START_DTM, NORMALCY)
              ) %>%
              filter(!is.na(LAB_RESULT))
```

Here all the ">" in b12 goes into the high normalcy so we might need to put them all in the same group...
```{r}
b12_ %>% 
  filter(str_detect(LAB_RESULT, ">")) %>% 
  select(MRN, LAB_RESULT, LAB_UNIT, EVENT_START_DTM, NORMALCY) %>% 
  arrange(NORMALCY)
```

Here the b12 normalcy overlap when looking at the available value range. Maybe ask a pharmacist...HAHAHA
```{r, rows.print = 200}
b12_ %>% 
  filter(!str_detect(LAB_RESULT, ">")) %>% 
  select(LAB_RESULT, NORMALCY) %>% 
  mutate(LAB_RESULT = as.numeric(LAB_RESULT)) %>% 
  tbl_summary(by= NORMALCY,
              statistic=list(all_continuous() ~ "{min} - {max}"))

b12_ %>% 
  filter(!str_detect(LAB_RESULT, ">")) %>% 
  select(MRN, LAB_RESULT, NORMALCY) %>% 
  mutate(LAB_RESULT = as.numeric(LAB_RESULT)) %>% 
  filter(LAB_RESULT > 212 & LAB_RESULT < 238) %>% 
  arrange(LAB_RESULT)

b12_ %>% 
  filter(!str_detect(LAB_RESULT, ">")) %>% 
  select(MRN, LAB_RESULT, NORMALCY) %>% 
  mutate(LAB_RESULT = as.numeric(LAB_RESULT)) %>% 
  filter(LAB_RESULT > 915 & LAB_RESULT < 1245) %>% 
  arrange(LAB_RESULT)

germline_patient_data <- germline_patient_data %>%
  left_join(., b12_,
            by = "MRN") %>%
  # Cleaning
  mutate(b12_germline_results = case_when(
    # Translate all character with ">" to numeric and add 1 for next step
    str_detect(LAB_RESULT, ">")            ~ as.numeric(str_remove(LAB_RESULT, ">")) + 1
  ),b12_germline_results = coalesce(b12_germline_results, as.numeric(LAB_RESULT)),
  b12_germline_results = case_when(
    b12_germline_results > 999 &
      b12_germline_results <= 1999         ~ 1500,
  b12_germline_results > 1999              ~ 2500,
  TRUE                                     ~ b12_germline_results
  )) %>% 

  # # Create var closest b12 results to diagnosis
  # mutate(int = abs(interval(start = LAB_DATE,
  #                       end = date_of_MM_diagnosis) /
  #          duration(n=1, units = "days"))) %>%
  # group_by(avatar_id) %>%
  # mutate(min = min(int)) %>%
  # ungroup() %>%
  # mutate(b12_MMdx_results = case_when(
  #   min == int               ~ LAB_RESULT,
  #   TRUE                     ~ NA_character_
  # )) %>%
  # Create var closest b12 results to germline
  mutate(int = abs(interval(start = EVENT_START_DTM,
                            end = collectiondt_germline) /
                     duration(n=1, units = "days"))) %>%
  arrange(avatar_id, int) %>% 
  select(-c(LAB_RESULT),
         b12_germline_results, b12_unit = LAB_UNIT, 
         b12_date = EVENT_START_DTM, b12_interpretation = NORMALCY) %>%
  distinct(avatar_id, .keep_all = TRUE)

germline_patient_data %>% 
  mutate(b12_to_germline = int) %>% 
  mutate(MMA_to_germline = abs(interval(start = MMA_date,
                            end = collectiondt_germline) /
                     duration(n=1, units = "days"))) %>%
  ggplot(aes(x=MMA_to_germline, y=b12_to_germline))+
  geom_point()+
  labs(x= "days from MMA to germline",
       y= "days from b12 to germline")

germline_patient_data %>% 
  mutate(int = round(int,0)) %>% 
  ggplot(aes(x=int))+
  geom_bar()+
  labs(x= "days from b12 to germline")

germline_patient_data %>% 
  mutate(int = round(int,0)) %>% 
  ggplot(aes(x=int))+
  geom_bar()+
  coord_cartesian(ylim = c(0, 5))+
  labs(x= "days from b12 to germline")

germline_patient_data %>% 
  mutate(int = abs(interval(start = b12_date,
                            end = MMA_date) /
                     duration(n=1, units = "days"))) %>%
  mutate(int = round(int,0)) %>% 
  ggplot(aes(x=int))+
  geom_bar()+
  labs(x= "days from b12 to MMA")
germline_patient_data %>% 
  mutate(int = abs(interval(start = b12_date,
                            end = MMA_date) /
                     duration(n=1, units = "days"))) %>%
  mutate(int = round(int,0)) %>% 
  ggplot(aes(x=int))+
  geom_bar()+
  coord_cartesian(ylim = c(0, 5))+
  labs(x= "days from b12 to MMA")
```

```{r more MMA}
germline_patient_data <- germline_patient_data %>%
  left_join(., MMA_2 %>%
              select(MRN, 
                     MMA_germline_results_Yifen = LAB_RESULT, 
                     MMA_date_Yifen = LAB_DATE),
            by = "MRN") %>%
  # Take MMA closest to germline
  pivot_longer(cols = c(MMA_germline_results, MMA_germline_results_Yifen),
             names_to = "MMA_data", values_to = "MMA_germline_results") %>%
  mutate(MMA_date = case_when(
    MMA_data == "MMA_germline_results"              ~ MMA_date,
    MMA_data == "MMA_germline_results_Yifen"        ~ MMA_date_Yifen
  )) %>%
  # Create var closest MMA_2 results to germline
  mutate(int = abs(interval(start = MMA_date,
                            end = collectiondt_germline) /
                     duration(n=1, units = "days"))) %>%
  arrange(avatar_id, int) %>%
  distinct(avatar_id, .keep_all = TRUE) %>%
  select(-c(int, MMA_date_Yifen))
```


```{r save data}
patients_MMA <- germline_patient_data %>% 
  select(avatar_id, MRN, starts_with("height"), starts_with("weight"), 
         starts_with("bmi"), starts_with("MMA"), #starts_with("egfr"), 
         CrCl,
         starts_with("creatinine"), 
         starts_with("b12"), -MMA_MMdx_results)

write_csv(germline_patient_data %>% 
  select(avatar_id, MRN, starts_with("height"), starts_with("weight"), 
         starts_with("bmi"), starts_with("MMA"), #starts_with("egfr"), 
         CrCl,
         starts_with("b12"), -MMA_MMdx_results),
  "patients MRN with MMA data.csv")
```


```{r more cleaning}
germline_patient_data <- germline_patient_data %>% 
  # Remove 1 duplicate patient 180
  distinct(avatar_id, .keep_all = TRUE) %>% 
  # replace value < 0.1 or < 0.10 by 0.05
  mutate_at(c("MMA_MMdx_results", "MMA_germline_results"), 
            ~ case_when(
    str_detect(., "<")                 ~ 0.05,
    TRUE                               ~ as.numeric(.)
  ))

germline_patient_data <- germline_patient_data %>% 
  mutate(MMA_germline_results_cat = case_when(
    MMA_germline_results <= 0.4          ~ "≤0.4 ~ normal",
    MMA_germline_results > 0.4           ~ ">0.4 ~ high"
  ), MMA_germline_results_cat = factor(MMA_germline_results_cat, 
                                       levels = c("≤0.4 ~ normal", ">0.4 ~ high"))
  ) #%>% 
  # Create cat compared to median - No need anymore
  # mutate(MMA_germline_results_cat1 = case_when(
  #   MMA_germline_results <= median(MMA_germline_results, na.rm = TRUE)          ~ "≤ median MMA",
  #   MMA_germline_results > median(MMA_germline_results, na.rm = TRUE)           ~ "> median MMA"
  # ), MMA_germline_results_cat1 = factor(MMA_germline_results_cat1, 
  #                                      levels = c("≤ median MMA", "> median MMA"))
  # )
```
<br>
<br>


***

# I. MMA levels distribution in MM patients (No limit of time between germline and diagnosis)

```{r summ table}
germline_patient_data %>% 
  mutate(Whole = "MM patients with WES") %>% 
  select(#MMA_MMdx_results, 
         MMA_germline_results, 
         creatinine_germline_results,
         calculated_CrCl,
         b12_germline_results,
         Age_at_MMonly_diagnosis, Sex, raceeth, 
         Whole, ISS_at_MMdx,
         Disease_Status_germline,
         bmi_combined,
         CH_status_no_indel) %>%
  tbl_summary(by = Whole, 
              label = list(raceeth ~ "Race/ethnicity", Age_at_MMonly_diagnosis ~ "Age at MM diagnosis"),
              sort = list(everything() ~ "frequency", ISS_at_MMdx ~ "alphanumeric"),
              digits = list(Age_at_MMonly_diagnosis ~ 2)#,
              # missing = "no"
              ) %>% 
  bold_labels()
```

Take a look at the creatinine and CrCl
```{r}
germline_patient_data %>% 
  filter(!is.na(creatinine_germline_results)) %>% 
  ggplot(aes(x= creatinine_germline_results))+
  geom_bar(stat = "count")+
  theme_classic()

germline_patient_data %>% 
  filter(!is.na(CrCl)) %>% 
  ggplot(aes(x= CrCl))+
  geom_bar(stat = "count")+
  theme_classic()
```

Patients with very low and high MMA values. Are they stable or is the value closest to germline is an artefact? 

```{r}
patient_id <- germline_patient_data %>% 
  filter(creatinine_germline_results > 4) %>% 
  select(MRN)

creatinine %>% 
  filter(str_detect(MRN, paste0(patient_id$MRN, collapse = "|"))) %>% 
  group_by(MRN) %>% 
  arrange(MRN, LAB_DATE) %>%
  mutate(lab_interval = LAB_DATE - lag(LAB_DATE), lab_interval = ifelse(is.na(lab_interval), 0, lab_interval)
         ) %>% 
  ggplot(aes(x=lab_interval , as.numeric(LAB_RESULT), color= MRN))+
  geom_line()+
  theme_classic()

creatinine %>% 
  filter(str_detect(MRN, paste0(patient_id$MRN, collapse = "|"))) %>% 
  group_by(MRN) %>% 
  arrange(MRN, LAB_DATE) %>%
  mutate(lab_interval = LAB_DATE - lag(LAB_DATE), lab_interval = ifelse(is.na(lab_interval), 0, lab_interval)
         ) %>% 
  ggplot(aes(x=lab_interval , as.numeric(LAB_RESULT), color= MRN))+
  geom_line()+
  xlim(0, 120)+
  theme_classic()

creatinine %>% 
  filter(str_detect(MRN, paste0(patient_id$MRN, collapse = "|"))) %>% 
  group_by(MRN) %>% 
  arrange(MRN, LAB_DATE) %>%
  mutate(lab_interval = LAB_DATE - lag(LAB_DATE), lab_interval = ifelse(is.na(lab_interval), 0, lab_interval)
         ) %>% 
  ggplot(aes(x=lab_interval , as.numeric(LAB_RESULT), color= MRN))+
  geom_line()+
  xlim(0, 25)+
  theme_classic()

creatinine %>% 
  filter(str_detect(MRN, paste0(patient_id$MRN, collapse = "|"))) %>% 
  group_by(MRN) %>% 
  arrange(MRN, LAB_DATE) %>%
  mutate(lab_interval = LAB_DATE - lag(LAB_DATE), lab_interval = ifelse(is.na(lab_interval), 0, lab_interval)
         ) %>% 
  select(MRN, LAB_DATE, lab_interval, LAB_RESULT)
```




```{r}
# germline_patient_data %>% 
#   filter(!is.na(MMA_MMdx_results)) %>% 
#   ggplot(aes(x= MMA_MMdx_results))+
#   geom_bar(stat = "count")+
#   geom_vline(xintercept = 0.4, color= "blue")+
#   theme_classic()
```

Already seen MMA at germline
```{r}
germline_patient_data %>% 
  filter(!is.na(MMA_germline_results)) %>% 
  ggplot(aes(x= MMA_germline_results))+
  geom_bar(stat = "count")+
  geom_vline(xintercept = 0.4, color= "blue")+
  theme_classic()
```

```{r}
# germline_patient_data %>% 
#   filter(!is.na(egfr_germline_results)) %>% 
#   ggplot(aes(x= egfr_germline_results))+
#   geom_bar(stat = "count")+
#   geom_vline(xintercept = 0.4, color= "blue")+
#   theme_classic()
```
<br>


# II. MMA levels by CH_status_no_indel
```{r by CH_status_no_indel}
contamination_tumor_ids <- paste("A025767", "A025771", "A007368", "A007322", "A000111", sep = "|")

patients_clean_tumor <- germline_patient_data %>% 
  filter(!str_detect(avatar_id, contamination_tumor_ids))
```

```{r}
patients_clean_tumor %>%
  select(#MMA_MMdx_results, 
         MMA_germline_results,
         CH_status_no_indel) %>% 
  tbl_summary(by = CH_status_no_indel, 
              label = list(CH_status_no_indel ~ "CH status wo indels"),
              sort = list(everything() ~ "frequency")) %>% 
  bold_labels() %>% add_p() %>% bold_p(t = .05) %>% 
  modify_spanning_header(all_stat_cols() ~ "**CH status wo indels**")
```

```{r}
# patients_clean_tumor %>% 
#   filter(!is.na(MMA_MMdx_results) & !is.na(CH_status_no_indel)) %>%
#   ggplot(aes(x= CH_status_no_indel, y=MMA_MMdx_results))+
#   geom_boxplot()+
#   theme_classic()+
#   stat_compare_means()
```

```{r}
patients_clean_tumor %>% 
  filter(!is.na(MMA_germline_results) & !is.na(CH_status_no_indel)) %>%
  ggplot(aes(x= CH_status_no_indel, y=MMA_germline_results))+
  geom_boxplot()+
  theme_classic()+
  stat_compare_means()
```
<br>

# III. MMA levels by CH_status_no_indel classes (DNA damages and TD)
DNA damage genes are TP53, PPM1D, CHEK2 and TD genes are TET2, DNMT3A.
```{r}
ch_wide <- ch_genes %>% 
  mutate(ARID1B = ifelse(GENE == "ARID1B", "Yes", NA_character_)) %>% 
  mutate(ASXL1 = ifelse(GENE == "ASXL1", "Yes", NA_character_)) %>% 
  mutate(ATM = ifelse(GENE == "ATM", "Yes", NA_character_)) %>% 
  mutate(CBL = ifelse(GENE == "CBL", "Yes", NA_character_)) %>% 
  mutate(CHEK2 = ifelse(GENE == "CHEK2", "Yes", NA_character_)) %>% 
  mutate(DNMT3A = ifelse(GENE == "DNMT3A", "Yes", NA_character_)) %>% 
  mutate(FLT3 = ifelse(GENE == "FLT3", "Yes", NA_character_)) %>% 
  mutate(IDH1 = ifelse(GENE == "IDH1", "Yes", NA_character_)) %>%
  mutate(JAK1 = ifelse(GENE == "JAK1", "Yes", NA_character_)) %>%
  mutate(JAK2 = ifelse(GENE == "JAK2", "Yes", NA_character_)) %>%
  mutate(KMT2D = ifelse(GENE == "KMT2D", "Yes", NA_character_)) %>%
  mutate(NOTCH1 = ifelse(GENE == "NOTCH1", "Yes", NA_character_)) %>%
  mutate(PPM1D = ifelse(GENE == "PPM1D", "Yes", NA_character_)) %>%
  mutate(RUNX1 = ifelse(GENE == "RUNX1", "Yes", NA_character_)) %>%
  mutate(SF3B1 = ifelse(GENE == "SF3B1", "Yes", NA_character_)) %>%
  mutate(STAG2 = ifelse(GENE == "STAG2", "Yes", NA_character_)) %>%
  mutate(STAT5B = ifelse(GENE == "STAT5B", "Yes", NA_character_)) %>%
  mutate(TET2 = ifelse(GENE == "TET2", "Yes", NA_character_)) %>%
  mutate(TP53 = ifelse(GENE == "TP53", "Yes", NA_character_)) %>%
  mutate(ZRSR2 = ifelse(GENE == "ZRSR2", "Yes", NA_character_)) %>%
  select(patient_id, ARID1B : ZRSR2) %>% 
  group_by(patient_id) %>% 
  fill(everything(), .direction = "updown") %>% 
  ungroup() %>% 
  distinct(patient_id, .keep_all = TRUE) %>% 
  mutate(across(where(is.character), .fns = ~ replace_na(., "No"))) %>% 
  # Create gene classes
  # DNA damage response genes (TP53, PPM1D, CHEK2)
  mutate(TD_class = case_when(
    DNMT3A == "Yes" |
      TET2 == "Yes"              ~ "Yes",
    TRUE                         ~ "No"
  )) %>% 
  mutate(DNA_damage_class = case_when(
    TP53 == "Yes" |
      PPM1D == "Yes" |
      CHEK2 == "Yes"             ~ "Yes",
    TRUE                         ~ "No"
  )) %>% 
  right_join(., patients_clean_tumor, by = c("patient_id" = "SLID_germline"))
```

## What are the CH genes mutated in blood?
Total pop is 673, % are calculated over CH patients only here 61.
```{r CH genes}
ch_wide %>% 
  select("ASXL1", "DNMT3A", "TET2", "TP53", "PPM1D",
         "SF3B1", "CBL", "JAK1", "STAT5B", 
         "ATM", "CHEK2",
         "FLT3", 
         "JAK2", "KMT2D", "NOTCH1", "RUNX1",
         "ZRSR2",
         "ARID1B", "IDH1", "STAG2",
         DNA_damage_class
         ) %>% 
  tbl_summary(type = list(all_categorical() ~ "dichotomous"),
              missing = "no") %>% 
  as_gt() %>% 
  gt::tab_source_note(gt::md("**Each gene is counted once per patient**"))
```
## MMA values by DNA damages Y/N
61 CH - 17 with DNA damages genes
```{r by DNA damages}
ch_wide %>%
  select(#MMA_MMdx_results, 
         MMA_germline_results,
         DNA_damage_class) %>% 
  tbl_summary(by = DNA_damage_class, 
              # label = list(CH_status_no_indel ~ "CH status wo indels"),
              sort = list(everything() ~ "frequency"),
              percent = "row") %>% 
  bold_labels() %>% add_p() %>% bold_p(t = .05) %>%
  modify_spanning_header(all_stat_cols() ~ "**DNA damage genes expressed?**")
```

## Sensitivity analysis - MMA values by CH status wo indels in DNA damage genes only
**When classify CH as mutations in DNA damage genes only. If no mutation in DNA damage genes, CH=no**
673 total patients - 61 patients CH, 579 no CH, 33 Ukn      - 44 CH but with No damages genes + 579 no CH = 623 patients
```{r}
ch_wide %>%
  # filter(DNA_damage_class == "Yes" | CH_status_no_indel == "No CH") %>% 
  mutate(CH_status_no_indel = case_when(
    DNA_damage_class == "No"                ~ "No CH",
    DNA_damage_class == "Yes"               ~ "CH",
    CH_status_no_indel == "No_CH"           ~ "No CH"
  )) %>%
  select(#MMA_MMdx_results, 
         MMA_germline_results,
         CH_status_no_indel, CH_status, ASXL1, DNA_damage_class) %>% 
  tbl_summary(by = CH_status_no_indel, 
              type = list(c(#MMA_MMdx_results, 
                            MMA_germline_results) ~ "continuous"),
              sort = list(everything() ~ "frequency"),
              percent = "row") %>% 
  bold_labels() %>% add_p() %>% bold_p(t = .05) %>%
  modify_spanning_header(all_stat_cols() ~ "**CH status**") %>% 
  modify_footnote(all_stat_cols() ~ "**If no mutation in DNA damage genes, CH=no**")
```
## MMA values by TET2/DNMT3A genes Y/N
81 CH - 25 with TD genes
```{r by TD}
ch_wide %>%
  select(#MMA_MMdx_results, 
         MMA_germline_results,
         TD_class) %>% 
  tbl_summary(by = TD_class, 
              # label = list(CH_status_no_indel ~ "CH status wo indels"),
              sort = list(everything() ~ "frequency"),
              percent = "row") %>% 
  bold_labels() %>% add_p() %>% bold_p(t = .05) %>%
  modify_spanning_header(all_stat_cols() ~ "**TD genes expressed?**")
```

## Sensitivity analysis - MMA values by CH status wo indels in TET2/DNMT3A genes only
**If no mutation in TD genes, CH=no**
673 total patients - 61 patients CH, 579 no CH, 33 Ukn      - 36 CH but with No TD genes + 579 no CH = 615 patients
```{r}
ch_wide %>%
  # filter(TD_class == "Yes" | CH_status_no_indel == "No_CH") %>% 
  mutate(CH_status_no_indel = case_when(
    TD_class == "No"                        ~ "No CH",
    TD_class == "Yes"                       ~ "CH",
    CH_status_no_indel == "No_CH"           ~ "No CH"
  )) %>%
  select(#MMA_MMdx_results, 
         MMA_germline_results,
         CH_status_no_indel) %>% 
  tbl_summary(by = CH_status_no_indel, 
              # label = list(CH_status_no_indel ~ "CH status wo indels"),
              type = list(c(#MMA_MMdx_results, 
                            MMA_germline_results) ~ "continuous"),
              sort = list(everything() ~ "frequency"),
              percent = "row") %>% 
  bold_labels() %>% add_p() %>% bold_p(t = .05) %>%
  modify_spanning_header(all_stat_cols() ~ "**CH status wo indels**") %>% 
    modify_footnote(all_stat_cols() ~ "**If no mutation in TD genes, CH=no**")
```
<br>

# IV. MMA level and VAF
**If a patient has > 1 CH mutation, we used their highest VAF only.**

```{r MMA level and VAF}
ch_genes %>% 
  full_join(., patients_clean_tumor, by = c("patient_id" = "SLID_germline")) %>% 
  arrange(avatar_id, desc(VAF_normal)) %>% 
  distinct(avatar_id, .keep_all = TRUE) %>% 
  mutate(CH_status_no_indel = case_when(
    CH_status_no_indel == "No_CH"             ~ "No_CH",
    CH_status_no_indel == "CH" &
      VAF_normal < 0.1            ~ "<10%",
    CH_status_no_indel == "CH" &
      VAF_normal >= 0.1           ~ "≥10%"
  )) %>% 
  select(#MMA_MMdx_results, 
         MMA_germline_results,
         CH_status_no_indel) %>% 
  tbl_summary(by = CH_status_no_indel, 
              label = list(CH_status_no_indel ~ "CH status wo indels"),
              sort = list(everything() ~ "frequency")) %>% 
  bold_labels() %>% add_p() %>% bold_p(t = .05) %>% add_q() %>%
  modify_spanning_header(all_stat_cols() ~ "**CH status wo indels**")
```

Paired comparison
<div class = "row">
<div class = "col-md-4">
```{r}
ch_genes %>% 
  full_join(., patients_clean_tumor, by = c("patient_id" = "SLID_germline")) %>% 
  arrange(avatar_id, desc(VAF_normal)) %>% 
  distinct(avatar_id, .keep_all = TRUE) %>% 
  mutate(CH_status_no_indel = case_when(
    CH_status_no_indel == "No_CH"             ~ "No_CH",
    CH_status_no_indel == "CH" &
      VAF_normal < 0.1            ~ "<10%",
    CH_status_no_indel == "CH" &
      VAF_normal >= 0.1           ~ "≥10%"
  )) %>% 
  filter(CH_status_no_indel == "<10%" | CH_status_no_indel == "≥10%") %>% 
  select(#MMA_MMdx_results, 
         MMA_germline_results,
         CH_status_no_indel) %>% 
  tbl_summary(by = CH_status_no_indel, 
              label = list(CH_status_no_indel ~ "CH status wo indels"),
              sort = list(everything() ~ "frequency")) %>% 
  bold_labels() %>% add_p() %>% bold_p(t = .05) %>% 
  modify_spanning_header(all_stat_cols() ~ "**CH status wo indels**")
```
</div>

<div class = "col-md-4">
```{r}
ch_genes %>% 
  full_join(., patients_clean_tumor, by = c("patient_id" = "SLID_germline")) %>% 
  arrange(avatar_id, desc(VAF_normal)) %>% 
  distinct(avatar_id, .keep_all = TRUE) %>% 
  mutate(CH_status_no_indel = case_when(
    CH_status_no_indel == "No_CH"             ~ "No_CH",
    CH_status_no_indel == "CH" &
      VAF_normal < 0.1            ~ "<10%",
    CH_status_no_indel == "CH" &
      VAF_normal >= 0.1           ~ "≥10%"
  )) %>% 
  filter(CH_status_no_indel == "No_CH" | CH_status_no_indel == "≥10%") %>% 
  select(#MMA_MMdx_results, 
         MMA_germline_results,
         CH_status_no_indel) %>% 
  tbl_summary(by = CH_status_no_indel, 
              label = list(CH_status_no_indel ~ "CH status wo indels"),
              sort = list(everything() ~ "frequency")) %>% 
  bold_labels() %>% add_p() %>% bold_p(t = .05) %>% 
  modify_spanning_header(all_stat_cols() ~ "**CH status wo indels**")
```
</div>

<div class = "col-md-4">
```{r}
ch_genes %>% 
  full_join(., patients_clean_tumor, by = c("patient_id" = "SLID_germline")) %>% 
  arrange(avatar_id, desc(VAF_normal)) %>% 
  distinct(avatar_id, .keep_all = TRUE) %>% 
  mutate(CH_status_no_indel = case_when(
    CH_status_no_indel == "No_CH"             ~ "No_CH",
    CH_status_no_indel == "CH" &
      VAF_normal < 0.1            ~ "<10%",
    CH_status_no_indel == "CH" &
      VAF_normal >= 0.1           ~ "≥10%"
  )) %>% 
  filter(CH_status_no_indel == "<10%" | CH_status_no_indel == "No_CH") %>% 
  select(#MMA_MMdx_results, 
         MMA_germline_results,
         CH_status_no_indel) %>% 
  tbl_summary(by = CH_status_no_indel, 
              label = list(CH_status_no_indel ~ "CH status wo indels"),
              sort = list(everything() ~ "frequency")) %>% 
  bold_labels() %>% add_p() %>% bold_p(t = .05) %>% 
  modify_spanning_header(all_stat_cols() ~ "**CH status wo indels**")
```
</div>
</div>

<!-- <div class = "row"> -->
<!-- <div class = "col-md-6"> -->
<!-- ```{r} -->
<!-- ch_genes %>% -->
<!--   left_join(., patients_clean_tumor, by = c("patient_id" = "SLID_germline")) %>% -->
<!--   ggplot(aes(x= MMA_MMdx_results, y= VAF_normal))+ -->
<!--   geom_point()+ -->
<!--   geom_smooth(method = "lm") + -->
<!--   stat_cor(size=5)+ -->
<!--   stat_regline_equation(label.x = 0.65, size=5)+ -->
<!--   theme_classic() -->
<!-- ``` -->
<!-- </div> -->

<!-- <div class = "col-md-6"> -->
<!-- ```{r} -->
<!-- ch_genes %>%  -->
<!--   left_join(., patients_clean_tumor, by = c("patient_id" = "SLID_germline")) %>%  -->
<!--   mutate(VAF_cat = case_when( -->
<!--     VAF_normal < 0.1            ~ "<10%", -->
<!--     VAF_normal >= 0.1           ~ "≥10%" -->
<!--   )) %>%  -->
<!--   filter(!is.na(VAF_cat)) %>%  -->
<!--   ggplot(aes(x= VAF_cat, y= MMA_MMdx_results, color= VAF_cat))+ -->
<!--   geom_boxplot()+ -->
<!--   geom_jitter()+ -->
<!--   theme_classic()+ -->
<!--   stat_compare_means(size=5) -->
<!-- ``` -->
<!-- </div> -->
<!-- </div> -->

<!-- ```{r} -->
<!-- ch_genes %>% -->
<!--   left_join(., patients_clean_tumor, by = c("patient_id" = "SLID_germline")) %>% -->
<!--   mutate(VAF_cat = case_when( -->
<!--     VAF_normal < 0.1            ~ "<10%", -->
<!--     VAF_normal >= 0.1           ~ "≥10%" -->
<!--   )) %>% -->
<!--   ggplot(aes(x= VAF_cat, y= MMA_MMdx_results, color= VAF_cat))+ -->
<!--   geom_boxplot()+ -->
<!--   geom_jitter()+ -->
<!--   theme_classic()+ -->
<!--   facet_wrap(. ~ CH_status_no_indel)+ -->
<!--   stat_compare_means(size=5) -->
<!-- ``` -->

<div class = "row">
<div class = "col-md-6">
```{r}
ch_genes %>% 
  left_join(., patients_clean_tumor, by = c("patient_id" = "SLID_germline")) %>% 
  ggplot(aes(x= MMA_germline_results, y= VAF_normal))+
  geom_point()+
  geom_smooth(method = "lm") +
  stat_cor(size=5)+ 
  stat_regline_equation(label.x = 0.65, size=5)+
  theme_classic()
```
</div>

<div class = "col-md-6">
```{r}
ch_genes %>% 
  left_join(., patients_clean_tumor, by = c("patient_id" = "SLID_germline")) %>% 
  mutate(VAF_cat = case_when(
    VAF_normal < 0.1            ~ "<10%",
    VAF_normal >= 0.1           ~ "≥10%"
  )) %>% 
  filter(!is.na(VAF_cat)) %>% 
  ggplot(aes(x= VAF_cat, y= MMA_germline_results, color= VAF_cat))+
  geom_boxplot()+
  geom_jitter()+
  theme_classic()+
  stat_compare_means(size=5)
```
</div>
</div>

```{r}
ch_genes %>%
  left_join(., patients_clean_tumor, by = c("patient_id" = "SLID_germline")) %>%
  mutate(VAF_cat = case_when(
    VAF_normal < 0.1            ~ "<10%",
    VAF_normal >= 0.1           ~ "≥10%"
  )) %>%
  ggplot(aes(x= VAF_cat, y= MMA_germline_results, color= VAF_cat))+
  geom_boxplot()+
  geom_jitter()+
  theme_classic()+
  facet_wrap(. ~ CH_status_no_indel)+
  stat_compare_means(size=5)
```


# V. Stratified by Gender
Looking within the patients with clean tumor aka 5 patients were removed because of tumor contamination (reason why the numbers male-female are lower than in the first table).
<div class = "row">
<div class = "col-md-6">
```{r Stratified by Gender}
patients_clean_tumor %>%
  select(#MMA_MMdx_results, 
         MMA_germline_results,
         Sex) %>% 
  tbl_summary(by = Sex, 
              sort = list(everything() ~ "frequency")) %>% 
  bold_labels() %>% add_p() %>% bold_p(t = .05)
```
</div>

<div class = "col-md-6">
```{r}
patients_clean_tumor %>% 
  filter(!is.na(MMA_germline_results) & !is.na(Sex)) %>%
  ggplot(aes(x= Sex, y=MMA_germline_results))+
  geom_boxplot()+
  theme_classic()+
  stat_compare_means()
```
</div>
</div>

```{r}
male <- patients_clean_tumor %>%
  filter(Sex == "Male") %>% 
  select(#MMA_MMdx_results, 
         MMA_germline_results,
         CH_status_no_indel) %>% 
  tbl_summary(by = CH_status_no_indel, 
              label = list(CH_status_no_indel ~ "CH status wo indels"),
              sort = list(everything() ~ "frequency")) %>% 
  bold_labels() %>% add_p() %>% bold_p(t = .05)

female <- patients_clean_tumor %>%
  filter(Sex == "Female") %>% 
  select(#MMA_MMdx_results, 
         MMA_germline_results,
         CH_status_no_indel) %>% 
  tbl_summary(by = CH_status_no_indel, 
              label = list(CH_status_no_indel ~ "CH status wo indels"),
              sort = list(everything() ~ "frequency")) %>% 
  bold_labels() %>% add_p() %>% bold_p(t = .05)

tbl_merge(list(male, female), tab_spanner = c("Male", "Female"))
```

```{r}
# patients_clean_tumor %>% 
#   filter(!is.na(MMA_MMdx_results) & !is.na(CH_status_no_indel)) %>%
#   ggplot(aes(x= Sex, y=MMA_MMdx_results, color= CH_status_no_indel))+
#   geom_boxplot()+
#   theme_classic()+
#   stat_compare_means()
```

```{r}
patients_clean_tumor %>% 
  filter(!is.na(MMA_germline_results) & !is.na(CH_status_no_indel)) %>%
  ggplot(aes(x= Sex, y=MMA_germline_results, color= CH_status_no_indel))+
  geom_boxplot()+
  theme_classic()+
  stat_compare_means()
```
<br>
<br>

# VI. Stratified by age

```{r}
germline_patient_data %>% 
  filter(!is.na(MMA_germline_results)) %>%
  mutate(Age_at_germcollect = round(Age_at_germcollect, 0)) %>% 
  select(MMA_germline_results, Age_at_germcollect) %>% 
  tbl_summary(by= Age_at_germcollect)

germline_patient_data %>% 
  filter(!is.na(MMA_germline_results)) %>%
  mutate(Age_at_germcollect = case_when(
    Age_at_germcollect < 50    ~ "<50",
    Age_at_germcollect >= 50 &
      Age_at_germcollect < 70    ~ "≥50-<70",
    Age_at_germcollect >= 70    ~ "≥70",
    
  )) %>% 
  
  select(MMA_germline_results, Age_at_germcollect) %>% 
  tbl_summary(by= Age_at_germcollect) %>% 
  bold_labels() %>% add_p() %>% bold_p(t = .05)

germline_patient_data %>% 
  # left_join(., patients_clean_tumor, by = c("patient_id" = "SLID_germline")) %>% 
  filter(!is.na(MMA_germline_results)) %>%
  mutate(Age_at_germcollect = round(Age_at_germcollect, 0)) %>% 
  ggplot(aes(x= MMA_germline_results, y= Age_at_germcollect))+
  geom_point()+
  geom_smooth(method = "lm") +
  stat_cor(size=5)+ 
  stat_regline_equation(label.x = 1, size=5)+
  theme_classic()
```




# VII. Survival

<div class = "row">
<div class = "col-md-6">
```{r Survival, fig.height = 7}
ggsurvplot(survfit(Surv(month_at_os, os_event) ~ MMA_germline_results_cat, 
                   data=patients_clean_tumor),
           title = "OS Analysis",
           font.main = c(20, "bold", "black"),
           font.x = c(18, "bold", "black"),
           font.y = c(18, "bold", "black"),
           font.legend = c(16, "black"),
           font.tickslab = c(16, "bold", "black"),
           size = 1.5,

           xlab = "Time in months",
           legend = "top",
           legend.title = "",
           pval = TRUE,
           conf.int = FALSE,
           # Censor
           censor = TRUE
) + guides(colour = guide_legend(ncol = 1))

tbl1 <- patients_clean_tumor %>% 
  select(MMA_germline_results_cat, 
         Age_at_MMonly_diagnosis, Sex, raceeth,
         calculated_CrCl, 
         bmi_germline_results, b12_germline_results, 
         CH_status_no_indel) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor$month_at_os, 
                             event = patients_clean_tumor$os_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor$month_at_os, 
             event = patients_clean_tumor$os_event) ~ 
               MMA_germline_results_cat + Age_at_MMonly_diagnosis + Sex + raceeth + calculated_CrCl + 
               bmi_germline_results + b12_germline_results + CH_status_no_indel, 
             data =  patients_clean_tumor) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)
tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))

tbl1 <- patients_clean_tumor %>% 
  select(MMA_germline_results, 
         Age_at_MMonly_diagnosis, Sex, raceeth,
         calculated_CrCl, 
         bmi_germline_results, b12_germline_results, 
         CH_status_no_indel) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor$month_at_os, 
                             event = patients_clean_tumor$os_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor$month_at_os, 
             event = patients_clean_tumor$os_event) ~ 
               MMA_germline_results + Age_at_MMonly_diagnosis + Sex + raceeth + calculated_CrCl + 
               bmi_germline_results + b12_germline_results + CH_status_no_indel, 
             data =  patients_clean_tumor) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))
```

CrCl as categorical
```{r, fig.height = 7}
tbl1 <- patients_clean_tumor %>% 
  select(MMA_germline_results_cat, 
         Age_at_MMonly_diagnosis, Sex, raceeth,
         CrCl_interpretation, 
         bmi_germline_results, b12_germline_results, 
         CH_status_no_indel) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor$month_at_os, 
                             event = patients_clean_tumor$os_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor$month_at_os, 
             event = patients_clean_tumor$os_event) ~ 
               MMA_germline_results_cat + Age_at_MMonly_diagnosis + Sex + raceeth + CrCl_interpretation + 
               bmi_germline_results + b12_germline_results + CH_status_no_indel, 
             data =  patients_clean_tumor) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))

tbl1 <- patients_clean_tumor %>% 
  select(MMA_germline_results, 
         Age_at_MMonly_diagnosis, Sex, raceeth,
         CrCl_interpretation, 
         bmi_germline_results, b12_germline_results, 
         CH_status_no_indel) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor$month_at_os, 
                             event = patients_clean_tumor$os_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor$month_at_os, 
             event = patients_clean_tumor$os_event) ~ 
               MMA_germline_results + Age_at_MMonly_diagnosis + Sex + raceeth + CrCl_interpretation + 
               bmi_germline_results + b12_germline_results + CH_status_no_indel, 
             data =  patients_clean_tumor) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))

# tbl1 <- patients_clean_tumor %>% 
#   select(MMA_germline_results_cat, 
#          Age_at_MMonly_diagnosis, Sex, raceeth,
#          ISS_at_MMdx, HCT_ever, regimen_categoryVCD_1, 
#          CH_status_no_indel) %>% 
#   tbl_uvregression(method = survival::coxph, 
#                    y = (Surv(time = patients_clean_tumor$month_at_os, 
#                              event = patients_clean_tumor$os_event)),
#                    exponentiate = TRUE) %>% 
#   bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
#   bold_labels() %>% italicize_levels()
# tbl2 <- coxph(Surv(time = patients_clean_tumor$month_at_os, 
#              event = patients_clean_tumor$os_event) ~ 
#                MMA_germline_results_cat + Age_at_MMonly_diagnosis + Sex + raceeth + ISS_at_MMdx + HCT_ever + regimen_categoryVCD_1 + CH_status_no_indel, 
#              data =  patients_clean_tumor) %>%
#   tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)
# 
# tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))

tbl1 <- patients_clean_tumor %>% 
  select(MMA_germline_results_cat, 
         Age_at_MMonly_diagnosis, Sex, raceeth,
         CH_status_no_indel) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor$month_at_os, 
                             event = patients_clean_tumor$os_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor$month_at_os, 
             event = patients_clean_tumor$os_event) ~ 
               MMA_germline_results_cat + Age_at_MMonly_diagnosis + Sex + raceeth + CH_status_no_indel, 
             data =  patients_clean_tumor) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))

tbl1 <- patients_clean_tumor %>% 
  select(MMA_germline_results, 
         Age_at_MMonly_diagnosis, Sex, raceeth,
         CH_status_no_indel) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor$month_at_os, 
                             event = patients_clean_tumor$os_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor$month_at_os, 
             event = patients_clean_tumor$os_event) ~ 
               MMA_germline_results + Age_at_MMonly_diagnosis + Sex + raceeth + CH_status_no_indel, 
             data =  patients_clean_tumor) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))
```
</div>

<div class = "col-md-6">
```{r, fig.height = 7}
ggsurvplot(survfit(Surv(month_at_progression_drug, drug_progression_event) ~ MMA_germline_results_cat, 
                   data=patients_clean_tumor),
           title = "PFS Analysis",
           font.main = c(20, "bold", "black"),
           font.x = c(18, "bold", "black"),
           font.y = c(18, "bold", "black"),
           font.legend = c(16, "black"),
           font.tickslab = c(16, "bold", "black"),
           size = 1.5,

           xlab = "Time in months",
           legend = "top",
           legend.title = "",
           pval = TRUE,
           conf.int = FALSE,
           # Censor
           censor = TRUE
) + guides(colour = guide_legend(ncol = 1))

tbl1 <- patients_clean_tumor %>% 
  select(MMA_germline_results_cat, 
         Age_at_MMonly_diagnosis, Sex, raceeth,
         calculated_CrCl, 
         bmi_germline_results, b12_germline_results, 
         CH_status_no_indel) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor$month_at_progression_drug, 
                             event = patients_clean_tumor$drug_progression_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor$month_at_progression_drug, 
             event = patients_clean_tumor$drug_progression_event) ~ 
               MMA_germline_results_cat + Age_at_MMonly_diagnosis + Sex + raceeth + calculated_CrCl + 
               bmi_germline_results + b12_germline_results + CH_status_no_indel, 
             data =  patients_clean_tumor) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))

tbl1 <- patients_clean_tumor %>% 
  select(MMA_germline_results, 
         Age_at_MMonly_diagnosis, Sex, raceeth,
         calculated_CrCl, 
         bmi_germline_results, b12_germline_results, 
         CH_status_no_indel) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor$month_at_progression_drug, 
                             event = patients_clean_tumor$drug_progression_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor$month_at_progression_drug, 
             event = patients_clean_tumor$drug_progression_event) ~ 
               MMA_germline_results + Age_at_MMonly_diagnosis + Sex + raceeth + calculated_CrCl + 
               bmi_germline_results + b12_germline_results + CH_status_no_indel, 
             data =  patients_clean_tumor) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))
```

CrCl as categorical
```{r, fig.height = 7}
tbl1 <- patients_clean_tumor %>% 
  select(MMA_germline_results_cat, 
         Age_at_MMonly_diagnosis, Sex, raceeth,
         CrCl_interpretation, 
         bmi_germline_results, b12_germline_results, 
         CH_status_no_indel) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor$month_at_progression_drug, 
                             event = patients_clean_tumor$drug_progression_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor$month_at_progression_drug, 
             event = patients_clean_tumor$drug_progression_event) ~ 
               MMA_germline_results_cat + Age_at_MMonly_diagnosis + Sex + raceeth + CrCl_interpretation + 
               bmi_germline_results + b12_germline_results + CH_status_no_indel, 
             data =  patients_clean_tumor) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))

tbl1 <- patients_clean_tumor %>% 
  select(MMA_germline_results, 
         Age_at_MMonly_diagnosis, Sex, raceeth,
         CrCl_interpretation, 
         bmi_germline_results, b12_germline_results, 
         CH_status_no_indel) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor$month_at_progression_drug, 
                             event = patients_clean_tumor$drug_progression_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor$month_at_progression_drug, 
             event = patients_clean_tumor$drug_progression_event) ~ 
               MMA_germline_results + Age_at_MMonly_diagnosis + Sex + raceeth + CrCl_interpretation + 
               bmi_germline_results + b12_germline_results + CH_status_no_indel, 
             data =  patients_clean_tumor) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))

# tbl1 <- patients_clean_tumor %>% 
#   select(MMA_germline_results_cat, 
#          Age_at_MMonly_diagnosis, Sex, raceeth,
#          ISS_at_MMdx, HCT_ever, regimen_categoryVCD_1, 
#          CH_status_no_indel) %>% 
#   tbl_uvregression(method = survival::coxph, 
#                    y = (Surv(time = patients_clean_tumor$month_at_progression_drug, 
#                              event = patients_clean_tumor$drug_progression_event)),
#                    exponentiate = TRUE) %>% 
#   bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
#   bold_labels() %>% italicize_levels()
# tbl2 <- coxph(Surv(time = patients_clean_tumor$month_at_progression_drug, 
#              event = patients_clean_tumor$drug_progression_event) ~ 
#                MMA_germline_results_cat + Age_at_MMonly_diagnosis + Sex + raceeth + ISS_at_MMdx + HCT_ever + regimen_categoryVCD_1 + CH_status_no_indel, 
#              data =  patients_clean_tumor) %>%
#   tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)
# 
# tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))

tbl1 <- patients_clean_tumor %>% 
  select(MMA_germline_results_cat, 
         Age_at_MMonly_diagnosis, Sex, raceeth,
         CH_status_no_indel) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor$month_at_progression_drug, 
                             event = patients_clean_tumor$drug_progression_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor$month_at_progression_drug, 
             event = patients_clean_tumor$drug_progression_event) ~ 
               MMA_germline_results_cat + Age_at_MMonly_diagnosis + Sex + raceeth + CH_status_no_indel, 
             data =  patients_clean_tumor) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))

tbl1 <- patients_clean_tumor %>% 
  select(MMA_germline_results, 
         Age_at_MMonly_diagnosis, Sex, raceeth,
         CH_status_no_indel) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor$month_at_progression_drug, 
                             event = patients_clean_tumor$drug_progression_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor$month_at_progression_drug, 
             event = patients_clean_tumor$drug_progression_event) ~ 
               MMA_germline_results + Age_at_MMonly_diagnosis + Sex + raceeth + CH_status_no_indel, 
             data =  patients_clean_tumor) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))
```
</div>
</div>

<div class = "row">
<div class = "col-md-6">
```{r, fig.height = 7}
ggsurvplot(survfit(Surv(month_at_os, os_event) ~ MMA_germline_results_cat + Sex, 
                   data=patients_clean_tumor),
           title = "OS Analysis",
           font.main = c(20, "bold", "black"),
           font.x = c(18, "bold", "black"),
           font.y = c(18, "bold", "black"),
           font.legend = c(16, "black"),
           font.tickslab = c(16, "bold", "black"),
           size = 1.5,

           xlab = "Time in months",
           legend = "top",
           legend.title = "",
           pval = TRUE,
           conf.int = FALSE,
           # Censor
           censor = TRUE
) + guides(colour = guide_legend(ncol = 1))
```
</div>

<div class = "col-md-6">
```{r, fig.height = 7}
ggsurvplot(survfit(Surv(month_at_progression_drug, drug_progression_event) ~ MMA_germline_results_cat + Sex, 
                   data=patients_clean_tumor),
           title = "PFS Analysis",
           font.main = c(20, "bold", "black"),
           font.x = c(18, "bold", "black"),
           font.y = c(18, "bold", "black"),
           font.legend = c(16, "black"),
           font.tickslab = c(16, "bold", "black"),
           size = 1.5,

           xlab = "Time in months",
           legend = "top",
           legend.title = "",
           pval = TRUE,
           conf.int = FALSE,
           # Censor
           censor = TRUE
) + guides(colour = guide_legend(ncol = 1))
```
</div>
</div>

## Stratified in Male
```{r, fig.height = 7}
patients_clean_tumor_male <- patients_clean_tumor %>% 
  filter(Sex == "Male")
```
<div class = "row">
<div class = "col-md-6">
```{r, fig.height = 7}
ggsurvplot(survfit(Surv(month_at_os, os_event) ~ MMA_germline_results_cat, 
                   data=patients_clean_tumor_male %>% 
                     filter(Sex == "Male")),
           title = "OS Analysis",
           font.main = c(20, "bold", "black"),
           font.x = c(18, "bold", "black"),
           font.y = c(18, "bold", "black"),
           font.legend = c(16, "black"),
           font.tickslab = c(16, "bold", "black"),
           size = 1.5,

           xlab = "Time in months",
           legend = "top",
           legend.title = "",
           pval = TRUE,
           conf.int = FALSE,
           # Censor
           censor = TRUE
) + guides(colour = guide_legend(ncol = 1))

tbl1 <- patients_clean_tumor_male %>% 
  select(MMA_germline_results_cat, 
         Age_at_MMonly_diagnosis, raceeth,
         calculated_CrCl, 
         bmi_germline_results, b12_germline_results,
         CH_status_no_indel) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor_male$month_at_os, 
                             event = patients_clean_tumor_male$os_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor_male$month_at_os, 
             event = patients_clean_tumor_male$os_event) ~ 
               MMA_germline_results_cat + Age_at_MMonly_diagnosis + raceeth + calculated_CrCl + 
               bmi_germline_results + b12_germline_results + CH_status_no_indel, 
             data =  patients_clean_tumor_male) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))

tbl1 <- patients_clean_tumor_male %>% 
  select(MMA_germline_results, 
         Age_at_MMonly_diagnosis, raceeth,
         calculated_CrCl, 
         bmi_germline_results, b12_germline_results,
         CH_status_no_indel) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor_male$month_at_os, 
                             event = patients_clean_tumor_male$os_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor_male$month_at_os, 
             event = patients_clean_tumor_male$os_event) ~ 
               MMA_germline_results + Age_at_MMonly_diagnosis + raceeth + calculated_CrCl + 
               bmi_germline_results + b12_germline_results + CH_status_no_indel, 
             data =  patients_clean_tumor_male) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))
# tbl1 <- patients_clean_tumor_male %>% 
#   select(MMA_germline_results_cat, 
#          Age_at_MMonly_diagnosis, raceeth,
#          ISS_at_MMdx, HCT_ever, regimen_categoryVCD_1,
#          CH_status_no_indel) %>% 
#   tbl_uvregression(method = survival::coxph, 
#                    y = (Surv(time = patients_clean_tumor_male$month_at_os, 
#                              event = patients_clean_tumor_male$os_event)),
#                    exponentiate = TRUE) %>% 
#   bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
#   bold_labels() %>% italicize_levels()
# tbl2 <- coxph(Surv(time = patients_clean_tumor_male$month_at_os, 
#              event = patients_clean_tumor_male$os_event) ~ 
#                MMA_germline_results_cat + Age_at_MMonly_diagnosis + raceeth + ISS_at_MMdx + HCT_ever + regimen_categoryVCD_1 + CH_status_no_indel, 
#              data =  patients_clean_tumor_male) %>%
#   tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)
# 
# tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))

tbl1 <- patients_clean_tumor_male %>% 
  select(MMA_germline_results_cat, 
         Age_at_MMonly_diagnosis, raceeth,
         CH_status_no_indel) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor_male$month_at_os, 
                             event = patients_clean_tumor_male$os_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor_male$month_at_os, 
             event = patients_clean_tumor_male$os_event) ~ 
               MMA_germline_results_cat + Age_at_MMonly_diagnosis + raceeth + CH_status_no_indel, 
             data =  patients_clean_tumor_male) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))

tbl1 <- patients_clean_tumor_male %>% 
  select(MMA_germline_results, 
         Age_at_MMonly_diagnosis, raceeth,
         CH_status_no_indel) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor_male$month_at_os, 
                             event = patients_clean_tumor_male$os_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor_male$month_at_os, 
             event = patients_clean_tumor_male$os_event) ~ 
               MMA_germline_results + Age_at_MMonly_diagnosis + raceeth + CH_status_no_indel, 
             data =  patients_clean_tumor_male) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))
```
</div>

<div class = "col-md-6">
```{r, fig.height = 7}
ggsurvplot(survfit(Surv(month_at_progression_drug, drug_progression_event) ~ MMA_germline_results_cat, 
                   data=patients_clean_tumor_male %>% 
                     filter(Sex == "Male")),
           title = "PFS Analysis",
           font.main = c(20, "bold", "black"),
           font.x = c(18, "bold", "black"),
           font.y = c(18, "bold", "black"),
           font.legend = c(16, "black"),
           font.tickslab = c(16, "bold", "black"),
           size = 1.5,

           xlab = "Time in months",
           legend = "top",
           legend.title = "",
           pval = TRUE,
           conf.int = FALSE,
           # Censor
           censor = TRUE
) + guides(colour = guide_legend(ncol = 1))

tbl1 <- patients_clean_tumor_male %>% 
  select(MMA_germline_results_cat, 
         Age_at_MMonly_diagnosis, raceeth,
         calculated_CrCl, 
         bmi_germline_results, b12_germline_results,
         CH_status_no_indel) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor_male$month_at_progression_drug, 
                             event = patients_clean_tumor_male$drug_progression_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor_male$month_at_progression_drug, 
             event = patients_clean_tumor_male$drug_progression_event) ~ 
               MMA_germline_results_cat + Age_at_MMonly_diagnosis + raceeth + calculated_CrCl + 
               bmi_germline_results + b12_germline_results + CH_status_no_indel, 
             data =  patients_clean_tumor_male) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))

tbl1 <- patients_clean_tumor_male %>% 
  select(MMA_germline_results, 
         Age_at_MMonly_diagnosis, raceeth,
         calculated_CrCl, 
         bmi_germline_results, b12_germline_results,
         CH_status_no_indel) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor_male$month_at_progression_drug, 
                             event = patients_clean_tumor_male$drug_progression_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor_male$month_at_progression_drug, 
             event = patients_clean_tumor_male$drug_progression_event) ~ 
               MMA_germline_results + Age_at_MMonly_diagnosis + raceeth + calculated_CrCl + 
               bmi_germline_results + b12_germline_results + CH_status_no_indel, 
             data =  patients_clean_tumor_male) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))
# tbl1 <- patients_clean_tumor_male %>% 
#   select(MMA_germline_results_cat, 
#          Age_at_MMonly_diagnosis, raceeth,
#          ISS_at_MMdx, HCT_ever, regimen_categoryVCD_1,
#          CH_status_no_indel) %>% 
#   tbl_uvregression(method = survival::coxph, 
#                    y = (Surv(time = patients_clean_tumor_male$month_at_progression_drug, 
#                              event = patients_clean_tumor_male$drug_progression_event)),
#                    exponentiate = TRUE) %>% 
#   bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
#   bold_labels() %>% italicize_levels()
# tbl2 <- coxph(Surv(time = patients_clean_tumor_male$month_at_progression_drug, 
#              event = patients_clean_tumor_male$drug_progression_event) ~ 
#                MMA_germline_results_cat + Age_at_MMonly_diagnosis + raceeth + ISS_at_MMdx + HCT_ever + regimen_categoryVCD_1 + CH_status_no_indel, 
#              data =  patients_clean_tumor_male) %>%
#   tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)
# 
# tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))

tbl1 <- patients_clean_tumor_male %>% 
  select(MMA_germline_results_cat, 
         Age_at_MMonly_diagnosis, raceeth,
         CH_status_no_indel) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor_male$month_at_progression_drug, 
                             event = patients_clean_tumor_male$drug_progression_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor_male$month_at_progression_drug, 
             event = patients_clean_tumor_male$drug_progression_event) ~ 
               MMA_germline_results_cat + Age_at_MMonly_diagnosis + raceeth + CH_status_no_indel, 
             data =  patients_clean_tumor_male) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))

tbl1 <- patients_clean_tumor_male %>% 
  select(MMA_germline_results, 
         Age_at_MMonly_diagnosis, raceeth,
         CH_status_no_indel) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor_male$month_at_progression_drug, 
                             event = patients_clean_tumor_male$drug_progression_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor_male$month_at_progression_drug, 
             event = patients_clean_tumor_male$drug_progression_event) ~ 
               MMA_germline_results + Age_at_MMonly_diagnosis + raceeth + CH_status_no_indel, 
             data =  patients_clean_tumor_male) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))
```
</div>
</div>

## Stratified in Female
```{r, fig.height = 7}
patients_clean_tumor_female <- patients_clean_tumor %>% 
  filter(Sex == "Female")
```
<div class = "row">
<div class = "col-md-6">
```{r, fig.height = 7}
ggsurvplot(survfit(Surv(month_at_os, os_event) ~ MMA_germline_results_cat, 
                   data=patients_clean_tumor_female),
           title = "OS Analysis",
           font.main = c(20, "bold", "black"),
           font.x = c(18, "bold", "black"),
           font.y = c(18, "bold", "black"),
           font.legend = c(16, "black"),
           font.tickslab = c(16, "bold", "black"),
           size = 1.5,

           xlab = "Time in months",
           legend = "top",
           legend.title = "",
           pval = TRUE,
           conf.int = FALSE,
           # Censor
           censor = TRUE
) + guides(colour = guide_legend(ncol = 1))

tbl1 <- patients_clean_tumor_female %>% 
  select(MMA_germline_results_cat, 
         Age_at_MMonly_diagnosis, raceeth,
         calculated_CrCl, 
         bmi_germline_results, b12_germline_results,
         CH_status) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor_female$month_at_os, 
                             event = patients_clean_tumor_female$os_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor_female$month_at_os, 
             event = patients_clean_tumor_female$os_event) ~ 
               MMA_germline_results_cat + Age_at_MMonly_diagnosis + raceeth + calculated_CrCl + 
               bmi_germline_results + b12_germline_results + CH_status, 
             data =  patients_clean_tumor_female) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))

tbl1 <- patients_clean_tumor_female %>% 
  select(MMA_germline_results, 
         Age_at_MMonly_diagnosis, raceeth,
         calculated_CrCl, 
         bmi_germline_results, b12_germline_results,
         CH_status) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor_female$month_at_os, 
                             event = patients_clean_tumor_female$os_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor_female$month_at_os, 
             event = patients_clean_tumor_female$os_event) ~ 
               MMA_germline_results + Age_at_MMonly_diagnosis + raceeth + calculated_CrCl + 
               bmi_germline_results + b12_germline_results + CH_status, 
             data =  patients_clean_tumor_female) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))

# tbl1 <- patients_clean_tumor_female %>% 
#   select(MMA_germline_results_cat, 
#          Age_at_MMonly_diagnosis, raceeth,
#          ISS_at_MMdx, HCT_ever, regimen_categoryVCD_1,
#          CH_status) %>% 
#   tbl_uvregression(method = survival::coxph, 
#                    y = (Surv(time = patients_clean_tumor_female$month_at_os, 
#                              event = patients_clean_tumor_female$os_event)),
#                    exponentiate = TRUE) %>% 
#   bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
#   bold_labels() %>% italicize_levels()
# tbl2 <- coxph(Surv(time = patients_clean_tumor_female$month_at_os, 
#              event = patients_clean_tumor_female$os_event) ~ 
#                MMA_germline_results_cat + Age_at_MMonly_diagnosis + raceeth + ISS_at_MMdx + HCT_ever + regimen_categoryVCD_1 + CH_status, 
#              data =  patients_clean_tumor_female) %>%
#   tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)
# 
# tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))

tbl1 <- patients_clean_tumor_female %>% 
  select(MMA_germline_results_cat, 
         Age_at_MMonly_diagnosis, raceeth,
         CH_status) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor_female$month_at_os, 
                             event = patients_clean_tumor_female$os_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor_female$month_at_os, 
             event = patients_clean_tumor_female$os_event) ~ 
               MMA_germline_results_cat + Age_at_MMonly_diagnosis + raceeth + CH_status, 
             data =  patients_clean_tumor_female) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))

tbl1 <- patients_clean_tumor_female %>% 
  select(MMA_germline_results, 
         Age_at_MMonly_diagnosis, raceeth,
         CH_status) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor_female$month_at_os, 
                             event = patients_clean_tumor_female$os_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor_female$month_at_os, 
             event = patients_clean_tumor_female$os_event) ~ 
               MMA_germline_results + Age_at_MMonly_diagnosis + raceeth + CH_status, 
             data =  patients_clean_tumor_female) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))
```
</div>

<div class = "col-md-6">
```{r, fig.height = 7}
ggsurvplot(survfit(Surv(month_at_progression_drug, drug_progression_event) ~ MMA_germline_results_cat, 
                   data=patients_clean_tumor_female),
           title = "PFS Analysis",
           font.main = c(20, "bold", "black"),
           font.x = c(18, "bold", "black"),
           font.y = c(18, "bold", "black"),
           font.legend = c(16, "black"),
           font.tickslab = c(16, "bold", "black"),
           size = 1.5,

           xlab = "Time in months",
           legend = "top",
           legend.title = "",
           pval = TRUE,
           conf.int = FALSE,
           # Censor
           censor = TRUE
) + guides(colour = guide_legend(ncol = 1))

tbl1 <- patients_clean_tumor_female %>% 
  select(MMA_germline_results_cat, 
         Age_at_MMonly_diagnosis, raceeth,
         calculated_CrCl, 
         bmi_germline_results, b12_germline_results,
         CH_status) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor_female$month_at_progression_drug, 
                             event = patients_clean_tumor_female$drug_progression_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor_female$month_at_progression_drug, 
             event = patients_clean_tumor_female$drug_progression_event) ~ 
               MMA_germline_results_cat + Age_at_MMonly_diagnosis + raceeth + calculated_CrCl + 
               bmi_germline_results + b12_germline_results + CH_status, 
             data =  patients_clean_tumor_female) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))

tbl1 <- patients_clean_tumor_female %>% 
  select(MMA_germline_results, 
         Age_at_MMonly_diagnosis, raceeth,
         calculated_CrCl, 
         bmi_germline_results, b12_germline_results,
         CH_status) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor_female$month_at_progression_drug, 
                             event = patients_clean_tumor_female$drug_progression_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor_female$month_at_progression_drug, 
             event = patients_clean_tumor_female$drug_progression_event) ~ 
               MMA_germline_results + Age_at_MMonly_diagnosis + raceeth + calculated_CrCl + 
               bmi_germline_results + b12_germline_results + CH_status, 
             data =  patients_clean_tumor_female) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))

# tbl1 <- patients_clean_tumor_female %>% 
#   select(MMA_germline_results_cat, 
#          Age_at_MMonly_diagnosis, raceeth,
#          ISS_at_MMdx, HCT_ever, regimen_categoryVCD_1,
#          CH_status) %>% 
#   tbl_uvregression(method = survival::coxph, 
#                    y = (Surv(time = patients_clean_tumor_female$month_at_progression_drug, 
#                              event = patients_clean_tumor_female$drug_progression_event)),
#                    exponentiate = TRUE) %>% 
#   bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
#   bold_labels() %>% italicize_levels()
# tbl2 <- coxph(Surv(time = patients_clean_tumor_female$month_at_progression_drug, 
#              event = patients_clean_tumor_female$drug_progression_event) ~ 
#                MMA_germline_results_cat + Age_at_MMonly_diagnosis + raceeth + ISS_at_MMdx + HCT_ever + regimen_categoryVCD_1 + CH_status, 
#              data =  patients_clean_tumor_female) %>%
#   tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)
# 
# tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))

tbl1 <- patients_clean_tumor_female %>% 
  select(MMA_germline_results_cat, 
         Age_at_MMonly_diagnosis, raceeth,
         CH_status) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor_female$month_at_progression_drug, 
                             event = patients_clean_tumor_female$drug_progression_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor_female$month_at_progression_drug, 
             event = patients_clean_tumor_female$drug_progression_event) ~ 
               MMA_germline_results_cat + Age_at_MMonly_diagnosis + raceeth + CH_status, 
             data =  patients_clean_tumor_female) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))

tbl1 <- patients_clean_tumor_female %>% 
  select(MMA_germline_results, 
         Age_at_MMonly_diagnosis, raceeth,
         CH_status) %>% 
  tbl_uvregression(method = survival::coxph, 
                   y = (Surv(time = patients_clean_tumor_female$month_at_progression_drug, 
                             event = patients_clean_tumor_female$drug_progression_event)),
                   exponentiate = TRUE) %>% 
  bold_p(t = .05) %>% add_nevent(location = "level") %>% add_n(location = "level") %>%
  bold_labels() %>% italicize_levels()
tbl2 <- coxph(Surv(time = patients_clean_tumor_female$month_at_progression_drug, 
             event = patients_clean_tumor_female$drug_progression_event) ~ 
               MMA_germline_results + Age_at_MMonly_diagnosis + raceeth + CH_status, 
             data =  patients_clean_tumor_female) %>%
  tbl_regression(exponentiate = TRUE) %>% bold_p(t = .05)

tbl_merge(list(tbl1, tbl2), tab_spanner = c("**Univariable**", "**Multivariable**"))
```
</div>
</div>

# Notes
- ~~Succinate~~

# Kidney function
- kidney dysfunction increases MMA   
```{r}
# germline_patient_data %>% 
#   mutate(egfr_germline_results = as.numeric(egfr_germline_results)) %>% 
#   filter(!is.na(egfr_interpretation)) %>% 
#   # left_join(., patients_clean_tumor, by = c("patient_id" = "SLID_germline")) %>% 
#   ggplot(aes(x= egfr_interpretation, y= egfr_germline_results))+
#   geom_boxplot()+
#   geom_jitter()+
#   theme_classic()
# 
germline_patient_data %>%
  # mutate(egfr_germline_results = as.numeric(egfr_germline_results)) %>%
  # left_join(., patients_clean_tumor, by = c("patient_id" = "SLID_germline")) %>%
  ggplot(aes(x= MMA_germline_results, y= calculated_CrCl))+
  geom_point()+
  geom_smooth(method = "lm") +
  stat_cor(size=5)+
  stat_regline_equation(label.x = 1, size=5)+
  theme_classic()

germline_patient_data %>%
  # mutate(egfr_germline_results = as.numeric(egfr_germline_results)) %>%
  # left_join(., patients_clean_tumor, by = c("patient_id" = "SLID_germline")) %>%
  ggplot(aes(x= CrCl_interpretation, y= MMA_germline_results))+
  geom_boxplot()

# # germline_patient_data %>% 
# #   filter(!is.na(egfr_interpretation)) %>% 
# #   # left_join(., patients_clean_tumor, by = c("patient_id" = "SLID_germline")) %>% 
# #   ggplot(aes(x= MMA_germline_results, y= egfr_interpretation))+
# #   geom_point()+
# #   theme_classic()
# 
# germline_patient_data %>% 
#   filter(!is.na(egfr_interpretation)) %>% 
#   # left_join(., patients_clean_tumor, by = c("patient_id" = "SLID_germline")) %>% 
#   ggplot(aes(x= egfr_interpretation, y= MMA_germline_results))+
#   geom_boxplot()+
#   geom_jitter()+
#   theme_classic()
```

# B12
```{r}
germline_patient_data %>%
  mutate(b12_germline_results = as.numeric(b12_germline_results)) %>%
  filter(!is.na(b12_interpretation)) %>%
  # left_join(., patients_clean_tumor, by = c("patient_id" = "SLID_germline")) %>%
  ggplot(aes(x= b12_interpretation, y= b12_germline_results))+
  geom_boxplot()+
  geom_jitter()+
  theme_classic()

germline_patient_data %>%
  mutate(b12_germline_results = as.numeric(b12_germline_results)) %>%
  # left_join(., patients_clean_tumor, by = c("patient_id" = "SLID_germline")) %>%
  ggplot(aes(x= MMA_germline_results, y= b12_germline_results))+
  geom_point()+
  geom_smooth(method = "lm") +
  stat_cor(size=5)+
  stat_regline_equation(label.x = 1, size=5)+
  theme_classic()

# germline_patient_data %>%
#   filter(!is.na(b12_interpretation)) %>%
#   # left_join(., patients_clean_tumor, by = c("patient_id" = "SLID_germline")) %>%
#   ggplot(aes(x= MMA_germline_results, y= b12_interpretation))+
#   geom_point()+
#   theme_classic()

germline_patient_data %>%
  filter(!is.na(b12_interpretation)) %>%
  # left_join(., patients_clean_tumor, by = c("patient_id" = "SLID_germline")) %>%
  ggplot(aes(x= b12_interpretation, y= MMA_germline_results))+
  geom_boxplot()+
  geom_jitter()+
  theme_classic()
```

# Association with MMA
Adjusted by the variables present in each table   
## Categorical
```{r}
patients_clean_tumor <- patients_clean_tumor %>% 
  mutate(MMA_germline_results_cat = case_when(
    MMA_germline_results_cat == "≤0.4 ~ normal"    ~ 0,
    MMA_germline_results_cat == ">0.4 ~ high"      ~ 1
  ))
patients_clean_tumor_female <- patients_clean_tumor_female %>% 
  mutate(MMA_germline_results_cat = case_when(
    MMA_germline_results_cat == "≤0.4 ~ normal"    ~ 0,
    MMA_germline_results_cat == ">0.4 ~ high"      ~ 1
  ))
patients_clean_tumor_male <- patients_clean_tumor_male %>% 
  mutate(MMA_germline_results_cat = case_when(
    MMA_germline_results_cat == "≤0.4 ~ normal"    ~ 0,
    MMA_germline_results_cat == ">0.4 ~ high"      ~ 1
  ))

glm(MMA_germline_results_cat ~ Age_at_MMonly_diagnosis + raceeth + CH_status,
             data = patients_clean_tumor) %>%
          tbl_regression(exponentiate = TRUE#,
                         # label = list(`data[[i]]` ~ i)
                         ) %>% 
           modify_spanning_header(everything() ~ paste("Association with MMA in overall data"))
glm(MMA_germline_results_cat ~ Age_at_MMonly_diagnosis + raceeth + calculated_CrCl + 
               bmi_germline_results + b12_germline_results + CH_status,
             data = patients_clean_tumor) %>%
          tbl_regression(exponentiate = TRUE#,
                         # label = list(`data[[i]]` ~ i)
                         ) %>% 
           modify_spanning_header(everything() ~ paste("Association with MMA in overall data"))

glm(MMA_germline_results_cat ~ Age_at_MMonly_diagnosis + raceeth + CH_status,
             data = patients_clean_tumor_female) %>%
          tbl_regression(exponentiate = TRUE#,
                         # label = list(`data[[i]]` ~ i)
                         ) %>% 
           modify_spanning_header(everything() ~ paste("Association with MMA in female data"))
glm(MMA_germline_results_cat ~ Age_at_MMonly_diagnosis + raceeth + calculated_CrCl + 
               bmi_germline_results + b12_germline_results + CH_status,
             data = patients_clean_tumor_female) %>%
          tbl_regression(exponentiate = TRUE#,
                         # label = list(`data[[i]]` ~ i)
                         ) %>% 
           modify_spanning_header(everything() ~ paste("Association with MMA in female data"))

glm(MMA_germline_results_cat ~ Age_at_MMonly_diagnosis + raceeth + CH_status,
             data = patients_clean_tumor_male) %>%
          tbl_regression(exponentiate = TRUE#,
                         # label = list(`data[[i]]` ~ i)
                         ) %>% 
           modify_spanning_header(everything() ~ paste("Association with MMA in male data"))
glm(MMA_germline_results_cat ~ Age_at_MMonly_diagnosis + raceeth + calculated_CrCl + 
               bmi_germline_results + b12_germline_results + CH_status,
             data = patients_clean_tumor_male) %>%
          tbl_regression(exponentiate = TRUE#,
                         # label = list(`data[[i]]` ~ i)
                         ) %>% 
           modify_spanning_header(everything() ~ paste("Association with MMA in male data"))
```

## Continuous
```{r}
glm(MMA_germline_results ~ Age_at_MMonly_diagnosis + raceeth + CH_status,
             data = patients_clean_tumor) %>%
          tbl_regression(exponentiate = TRUE#,
                         # label = list(`data[[i]]` ~ i)
                         ) %>% 
           modify_spanning_header(everything() ~ paste("Association with MMA in overall data"))
glm(MMA_germline_results ~ Age_at_MMonly_diagnosis + raceeth + calculated_CrCl + 
               bmi_germline_results + b12_germline_results + CH_status,
             data = patients_clean_tumor) %>%
          tbl_regression(exponentiate = TRUE#,
                         # label = list(`data[[i]]` ~ i)
                         ) %>% 
           modify_spanning_header(everything() ~ paste("Association with MMA in overall data"))

glm(MMA_germline_results ~ Age_at_MMonly_diagnosis + raceeth + CH_status,
             data = patients_clean_tumor_female) %>%
          tbl_regression(exponentiate = TRUE#,
                         # label = list(`data[[i]]` ~ i)
                         ) %>% 
           modify_spanning_header(everything() ~ paste("Association with MMA in female data"))
glm(MMA_germline_results ~ Age_at_MMonly_diagnosis + raceeth + calculated_CrCl + 
               bmi_germline_results + b12_germline_results + CH_status,
             data = patients_clean_tumor_female) %>%
          tbl_regression(exponentiate = TRUE#,
                         # label = list(`data[[i]]` ~ i)
                         ) %>% 
           modify_spanning_header(everything() ~ paste("Association with MMA in female data"))

glm(MMA_germline_results ~ Age_at_MMonly_diagnosis + raceeth + CH_status,
             data = patients_clean_tumor_male) %>%
          tbl_regression(exponentiate = TRUE#,
                         # label = list(`data[[i]]` ~ i)
                         ) %>% 
           modify_spanning_header(everything() ~ paste("Association with MMA in male data"))
glm(MMA_germline_results ~ Age_at_MMonly_diagnosis + raceeth + calculated_CrCl + 
               bmi_germline_results + b12_germline_results + CH_status,
             data = patients_clean_tumor_male) %>%
          tbl_regression(exponentiate = TRUE#,
                         # label = list(`data[[i]]` ~ i)
                         ) %>% 
           modify_spanning_header(everything() ~ paste("Association with MMA in male data"))
```
